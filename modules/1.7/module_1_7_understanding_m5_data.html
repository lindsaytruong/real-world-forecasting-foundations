<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 1.7: Understanding the M5 Dataset</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Color palette
        const colors = {
          primary: '#2596be',
          dark: '#1d1f56',
          accent: '#2d42a7',
          purple: '#3a2f7e',
          light: '#53b4e6',
          gray: '#8b8b8b',
          danger: '#c41e3a',
          success: '#06A77D'
        };

        // Icons
        const ChevronRight = ({ className }) => <svg className={className} width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>;
        const AlertTriangle = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>;
        const CheckCircle = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const Database = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>;
        const Calendar = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const DollarSign = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const ArrowRight = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>;

        // Tab configuration
        const tabs = [
          { id: 'raw', icon: 'üìä', label: 'Raw Data', question: 'The M5 Data Structure: 3 files, 1 dataset' },
          { id: 'vocabulary', icon: 'üìö', label: 'Vocabulary', question: 'What do these terms mean?' },
          { id: 'explore', icon: 'üîç', label: 'Explore', question: "What's in each file?" },
          { id: 'transform', icon: 'üõ†Ô∏è', label: 'Transform', question: 'How do I make this forecast-ready?' },
          { id: 'cheatsheet', icon: 'üöÄ', label: 'Cheat Sheet', question: 'Your go-to reference' }
        ];

        // Simplified Journey Progress Header (no start/goal tables)
        const JourneyHeader = ({ activeTab, setActiveTab }) => {
          const activeIndex = tabs.findIndex(t => t.id === activeTab);
          
          return (
            <div className="bg-white rounded-xl p-6 mb-6 shadow-lg border-2 border-gray-100">
              {/* Progress Bar */}
              <div className="relative">
                <div className="absolute top-4 left-0 right-0 h-1 bg-gray-200 rounded"></div>
                <div 
                  className="absolute top-4 left-0 h-1 rounded transition-all duration-300"
                  style={{ 
                    width: `${(activeIndex / (tabs.length - 1)) * 100}%`,
                    backgroundColor: colors.primary
                  }}
                ></div>
                
                <div className="relative flex justify-between">
                  {tabs.map((tab, index) => {
                    const isActive = tab.id === activeTab;
                    const isPast = index < activeIndex;
                    
                    return (
                      <button
                        key={tab.id}
                        onClick={() => setActiveTab(tab.id)}
                        className="flex flex-col items-center group"
                      >
                        <div 
                          className="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-200 border-2"
                          style={{
                            backgroundColor: isActive ? colors.primary : isPast ? colors.light : 'white',
                            borderColor: isActive ? colors.primary : isPast ? colors.light : '#e5e7eb',
                            color: isActive || isPast ? 'white' : colors.gray
                          }}
                        >
                          {isPast ? '‚úì' : tab.icon}
                        </div>
                        <div 
                          className="text-xs font-semibold mt-2 transition-colors"
                          style={{ color: isActive ? colors.primary : colors.gray }}
                        >
                          {tab.label}
                        </div>
                      </button>
                    );
                  })}
                </div>
              </div>
              
              {/* Current Tab Question */}
              <div 
                className="mt-6 p-4 rounded-lg text-center"
                style={{ backgroundColor: `${colors.primary}10` }}
              >
                <span className="text-2xl mr-2">{tabs[activeIndex].icon}</span>
                <span className="font-bold text-lg" style={{ color: colors.dark }}>
                  {tabs[activeIndex].question}
                </span>
              </div>
            </div>
          );
        };

        // Transition CTA Component
        const TransitionCTA = ({ text, onClick }) => (
          <div 
            onClick={onClick}
            className="mt-8 p-4 rounded-lg flex items-center justify-between cursor-pointer hover:shadow-md transition-all group"
            style={{ backgroundColor: `${colors.primary}10`, border: `2px solid ${colors.primary}` }}
          >
            <span className="font-semibold" style={{ color: colors.dark }}>{text}</span>
            <div 
              className="flex items-center gap-1 font-bold group-hover:translate-x-1 transition-transform"
              style={{ color: colors.primary }}
            >
              Continue <ChevronRight />
            </div>
          </div>
        );

        // ==================== RAW DATA TAB ====================
        const RawDataTab = ({ setActiveTab }) => {
          const files = [
            { name: 'sales_train.csv', icon: <Database className="w-8 h-8" />, color: colors.primary, role: 'Historical daily sales', shape: '30,490 √ó 1,947', description: 'Each row is one item-store. Days are columns (d_1 to d_1941).' },
            { name: 'calendar.csv', icon: <Calendar className="w-8 h-8" />, color: colors.purple, role: 'Date information', shape: '1,969 √ó 14', description: 'Maps d_X codes to actual dates. Contains events, weekdays, SNAP info.' },
            { name: 'sell_prices.csv', icon: <DollarSign className="w-8 h-8" />, color: colors.danger, role: 'Weekly pricing', shape: '6,841,121 √ó 4', description: 'Price per item-store-week. Handle with care‚Äîleakage risk!' }
          ];

          return (
            <div className="space-y-6">
              {/* M5 Overview */}
              <div className="bg-white rounded-xl p-8 shadow-lg">
                <h3 className="text-2xl font-bold mb-4" style={{ color: colors.dark }}>What is M5?</h3>
                <p className="text-gray-700 mb-4">
                  The M5 dataset comes from Walmart and contains <strong>~5 years of daily sales data</strong> for thousands of items across multiple stores. Your goal: predict future sales for 3,049 products across 10 stores in 3 US states (CA, TX, WI).
                </p>
                <p className="text-gray-600 mb-6">
                  It's split into several files, each serving a specific role in the forecasting pipeline. This module walks you through: <strong>raw files ‚Üí understanding each column ‚Üí transforming into forecast-ready format.</strong>
                </p>
                
                <div className="rounded-lg p-4" style={{ backgroundColor: `${colors.accent}10`, borderLeft: `4px solid ${colors.accent}` }}>
                  <h4 className="font-bold mb-2" style={{ color: colors.dark }}>üí° Why This Matters</h4>
                  <p className="text-sm" style={{ color: colors.accent }}>
                    Understanding how these tables connect and what each field represents is not just academic ‚Äî it's the difference between a model that works in notebooks and one that survives production. <strong>Most forecasting failures happen at the data preparation stage, not the modeling stage.</strong>
                  </p>
                </div>
              </div>

              <div className="bg-white rounded-xl p-6 shadow-lg">
                <p className="text-gray-700">These are the <strong>raw, untransformed files</strong> exactly as downloaded from Kaggle. No preprocessing has been applied yet.</p>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {files.map(file => (
                  <div key={file.name} className="bg-white rounded-xl p-6 shadow-lg border-t-4 hover:shadow-xl transition-shadow" style={{ borderColor: file.color }}>
                    <div style={{ color: file.color }} className="mb-3">{file.icon}</div>
                    <div className="font-bold text-lg mb-1" style={{ color: colors.dark }}>{file.name}</div>
                    <div className="text-sm font-semibold mb-2" style={{ color: file.color }}>{file.role}</div>
                    <div className="text-sm text-gray-600 mb-3">{file.description}</div>
                    <div className="text-xs bg-gray-100 rounded px-2 py-1 font-mono inline-block">{file.shape}</div>
                  </div>
                ))}
              </div>

              {/* Hierarchy Diagram */}
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <h3 className="text-xl font-bold mb-6" style={{ color: colors.dark }}>Data Hierarchies</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                  {/* Product Hierarchy */}
                  <div>
                    <div className="text-center mb-4">
                      <span className="inline-block px-4 py-2 rounded-lg text-white font-bold" style={{ backgroundColor: colors.accent }}>Product Hierarchy</span>
                    </div>
                    <div className="space-y-2">
                      {[
                        { level: 'Category', field: 'cat_id', count: '3 total' },
                        { level: 'Department', field: 'dept_id', count: '7 total' },
                        { level: 'Item', field: 'item_id', count: '3,049 total' }
                      ].map((item, idx) => (
                        <div key={item.level}>
                          <div className="p-3 rounded-lg text-center" style={{ backgroundColor: `${colors.accent}${15 + idx * 10}`, border: `2px solid ${colors.accent}` }}>
                            <div className="text-xs font-bold" style={{ color: colors.accent }}>{item.level}</div>
                            <code className="font-bold" style={{ color: colors.dark }}>{item.field}</code>
                            <div className="text-xs text-gray-500">{item.count}</div>
                          </div>
                          {idx < 2 && <div className="text-center text-gray-300 text-xl">‚Üì</div>}
                        </div>
                      ))}
                    </div>
                    <div className="mt-3 text-xs text-center text-gray-500">Example: FOODS ‚Üí FOODS_3 ‚Üí FOODS_3_090</div>
                  </div>

                  {/* Location Hierarchy */}
                  <div>
                    <div className="text-center mb-4">
                      <span className="inline-block px-4 py-2 rounded-lg text-white font-bold" style={{ backgroundColor: colors.success }}>Location Hierarchy</span>
                    </div>
                    <div className="space-y-2">
                      {[
                        { level: 'State', field: 'state_id', count: '3 total (CA, TX, WI)' },
                        { level: 'Store', field: 'store_id', count: '10 total' }
                      ].map((item, idx) => (
                        <div key={item.level}>
                          <div className="p-3 rounded-lg text-center" style={{ backgroundColor: `${colors.success}${15 + idx * 15}`, border: `2px solid ${colors.success}` }}>
                            <div className="text-xs font-bold" style={{ color: colors.success }}>{item.level}</div>
                            <code className="font-bold" style={{ color: colors.dark }}>{item.field}</code>
                            <div className="text-xs text-gray-500">{item.count}</div>
                          </div>
                          {idx < 1 && <div className="text-center text-gray-300 text-xl">‚Üì</div>}
                        </div>
                      ))}
                    </div>
                    <div className="mt-3 text-xs text-center text-gray-500">Example: CA ‚Üí CA_3</div>
                  </div>
                </div>
              </div>

              {/* Current State Warning */}
              <div className="rounded-xl p-6 shadow-lg" style={{ backgroundColor: `${colors.danger}10`, border: `2px solid ${colors.danger}` }}>
                <div className="flex items-start gap-3">
                  <AlertTriangle className="w-6 h-6 flex-shrink-0" style={{ color: colors.danger }} />
                  <div>
                    <div className="font-bold text-lg mb-2" style={{ color: colors.dark }}>Current State: NOT Forecast-Ready</div>
                    <div className="text-sm text-gray-700 space-y-1">
                      <div>‚Ä¢ <strong>Wide format</strong> ‚Äî days are columns (d_1, d_2, ... d_1941)</div>
                      <div>‚Ä¢ <strong>No unified series ID</strong> ‚Äî item and store are separate columns</div>
                      <div>‚Ä¢ <strong>Dates are codes</strong> ‚Äî d_1 instead of 2011-01-29</div>
                      <div>‚Ä¢ <strong>Prices separate</strong> ‚Äî need to join carefully to avoid leakage</div>
                    </div>
                  </div>
                </div>
              </div>

              <TransitionCTA text="Before transforming, learn the vocabulary you'll need" onClick={() => setActiveTab('vocabulary')} />
            </div>
          );
        };

        // ==================== VOCABULARY TAB ====================
        const VocabularyTab = ({ setActiveTab }) => {
          const concepts = [
            { id: 'static', title: 'STATIC', color: colors.success, icon: '‚úì', definition: 'Attributes that NEVER change over time for a given entity.', keyQuestion: 'Does this value stay constant for this item/store?', examples: ['item_id', 'dept_id', 'cat_id', 'store_id', 'state_id'], safe: true, watchOut: 'In M5 these are truly static. In real life, things like store size might change after renovations.' },
            { id: 'known-at', title: 'KNOWN-AT-TIME', color: colors.purple, icon: 'üìÖ', definition: 'Features that change over time BUT are known in advance from calendars or schedules.', keyQuestion: 'Is this value determined by a predetermined calendar?', examples: ['date', 'weekday', 'month', 'event_name', 'snap_CA'], safe: true, watchOut: 'Known EVENT ‚â† Known IMPACT. You know Christmas is Dec 25, but not how much sales will spike.' },
            { id: 'dynamic', title: 'DYNAMIC (Unknown)', color: colors.danger, icon: '‚ö†Ô∏è', definition: 'Features that change over time and are NOT known at forecast time.', keyQuestion: 'Will I actually know this value when making the forecast?', examples: ['sell_price (future)', 'competitor actions'], safe: false, watchOut: 'This is where leakage happens. sell_price for next week is UNKNOWN‚Äîuse lagged or planned values instead.' },
            { id: 'target', title: 'TARGET', color: colors.dark, icon: 'üéØ', definition: "The variable you're predicting. Past values can be features, future/current values CANNOT.", keyQuestion: 'Am I trying to predict this?', examples: ['d_1', 'd_2', '...', 'd_1941', '‚Üí becomes y'], safe: false, watchOut: 'The #1 mistake: using d_100 to predict d_100. You CAN use d_1...d_99 as lag features.' }
          ];

          return (
            <div className="space-y-6">
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <p className="text-gray-700 text-lg">Every feature column falls into one of four categories. Learn these‚Äîyou'll use them constantly.</p>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {concepts.map(concept => (
                  <div key={concept.id} className="bg-white rounded-xl p-6 shadow-lg border-l-4" style={{ borderColor: concept.color }}>
                    <div className="flex items-center gap-3 mb-3">
                      <div className="w-10 h-10 rounded-full flex items-center justify-center text-lg" style={{ backgroundColor: `${concept.color}20`, color: concept.color }}>{concept.icon}</div>
                      <div>
                        <div className="font-bold text-lg" style={{ color: concept.color }}>{concept.title}</div>
                        <div className="text-xs" style={{ color: concept.safe ? colors.success : colors.danger }}>{concept.safe ? '‚úì Safe to use' : '‚ö†Ô∏è Handle with care'}</div>
                      </div>
                    </div>
                    <div className="text-sm text-gray-700 mb-3">{concept.definition}</div>
                    <div className="mb-3 p-2 rounded" style={{ backgroundColor: `${concept.color}10` }}>
                      <div className="text-xs font-bold mb-1" style={{ color: concept.color }}>Key Question:</div>
                      <div className="text-sm italic" style={{ color: colors.dark }}>{concept.keyQuestion}</div>
                    </div>
                    <div className="flex flex-wrap gap-1 mb-3">
                      {concept.examples.map((ex, i) => (
                        <code key={i} className="text-xs px-2 py-1 rounded" style={{ backgroundColor: `${concept.color}15`, color: concept.color }}>{ex}</code>
                      ))}
                    </div>
                    <div className="text-xs p-2 rounded bg-yellow-50 border-l-2 border-yellow-400">
                      <strong>Watch out:</strong> {concept.watchOut}
                    </div>
                  </div>
                ))}
              </div>

              {/* Mental Model Flowchart */}
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <h3 className="text-xl font-bold mb-4" style={{ color: colors.dark }}>Mental Model: Classifying Any Column</h3>
                <div className="flex flex-col items-center space-y-4">
                  <div className="bg-gray-100 rounded-lg px-6 py-3 font-semibold text-center">Is this the value I'm trying to predict?</div>
                  <div className="flex gap-8 items-start">
                    <div className="flex flex-col items-center">
                      <div className="text-sm font-bold text-gray-500 mb-2">YES</div>
                      <div className="px-4 py-2 rounded-lg text-white font-bold" style={{ backgroundColor: colors.dark }}>TARGET</div>
                    </div>
                    <div className="flex flex-col items-center">
                      <div className="text-sm font-bold text-gray-500 mb-2">NO ‚Üì</div>
                      <div className="bg-gray-100 rounded-lg px-6 py-3 font-semibold text-center mb-4">Does it change over time?</div>
                      <div className="flex gap-8 items-start">
                        <div className="flex flex-col items-center">
                          <div className="text-sm font-bold text-gray-500 mb-2">NO</div>
                          <div className="px-4 py-2 rounded-lg text-white font-bold" style={{ backgroundColor: colors.success }}>STATIC</div>
                        </div>
                        <div className="flex flex-col items-center">
                          <div className="text-sm font-bold text-gray-500 mb-2">YES ‚Üì</div>
                          <div className="bg-gray-100 rounded-lg px-4 py-2 font-semibold text-center text-sm mb-4">Known in advance?</div>
                          <div className="flex gap-6">
                            <div className="flex flex-col items-center">
                              <div className="text-sm font-bold text-gray-500 mb-2">YES</div>
                              <div className="px-3 py-2 rounded-lg text-white font-bold text-sm" style={{ backgroundColor: colors.purple }}>KNOWN-AT</div>
                            </div>
                            <div className="flex flex-col items-center">
                              <div className="text-sm font-bold text-gray-500 mb-2">NO</div>
                              <div className="px-3 py-2 rounded-lg text-white font-bold text-sm" style={{ backgroundColor: colors.danger }}>DYNAMIC</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <TransitionCTA text="Now see how each M5 column is classified" onClick={() => setActiveTab('explore')} />
            </div>
          );
        };

        // ==================== EXPLORE TAB (Detailed Tables from Original) ====================
        const ExploreTab = ({ setActiveTab }) => {
          const [selectedTable, setSelectedTable] = useState(null);

          const tables = {
            sales: {
              name: 'sales_train.csv',
              icon: <Database className="w-6 h-6" />,
              color: colors.primary,
              role: 'TARGET + STATIC IDENTIFIERS',
              shape: '30,490 rows √ó 1,947 columns',
              keyPoint: 'Each row = one item-store combination. Columns d_1...d_1941 are daily unit sales starting from 2011-01-29.',
              fields: [
                { name: 'item_id', type: 'static', classification: 'STATIC IDENTIFIER', desc: 'Product ID (3,049 unique items)', knownAt: 'Always', leakage: 'No risk', example: 'FOODS_3_090' },
                { name: 'dept_id', type: 'static', classification: 'STATIC FEATURE', desc: 'Department (7 departments)', knownAt: 'Always', leakage: 'No risk', example: 'FOODS_3' },
                { name: 'cat_id', type: 'static', classification: 'STATIC FEATURE', desc: 'Category (FOODS, HOBBIES, HOUSEHOLD)', knownAt: 'Always', leakage: 'No risk', example: 'FOODS' },
                { name: 'store_id', type: 'static', classification: 'STATIC IDENTIFIER', desc: 'Store (10 stores)', knownAt: 'Always', leakage: 'No risk', example: 'CA_3' },
                { name: 'state_id', type: 'static', classification: 'STATIC FEATURE', desc: 'State (CA, TX, WI)', knownAt: 'Always', leakage: 'No risk', example: 'CA' },
                { name: 'd_1...d_1941', type: 'target', classification: 'TARGET VARIABLE', desc: 'Daily unit sales starting 2011-01-29', knownAt: 'Only up to forecast date', leakage: 'HIGH RISK', example: 'd_1=3, d_2=0, d_3=5' }
              ],
              warnings: [
                { title: 'Wide Format Alert', text: 'Data comes in WIDE format (days as columns). Must reshape to LONG format: (unique_id, ds, y). The unique_id should combine item_id + store_id.' },
                { title: 'Target Column Leakage', text: 'When forecasting d_1900, you can only use d_1...d_1899 as features. Never include future days in training.' },
                { title: 'No Explicit ID Column', text: 'No single "id" column exists. You must create unique_id by combining item_id and store_id (e.g., "FOODS_3_090_CA_3").' }
              ]
            },
            calendar: {
              name: 'calendar.csv',
              icon: <Calendar className="w-6 h-6" />,
              color: colors.purple,
              role: 'KNOWN-AT-TIME FEATURES',
              shape: '1,969 rows √ó 14 columns',
              keyPoint: 'Master date table. Join to sales via date or d_X. ALL fields are safe to use.',
              fields: [
                { name: 'date', type: 'known', classification: 'TIME IDENTIFIER', desc: 'Date in y-m-d format', knownAt: 'Always', leakage: 'No risk', example: '2011-01-29' },
                { name: 'wm_yr_wk', type: 'known', classification: 'TIME GROUPING', desc: 'Walmart week ID (for price joins)', knownAt: 'Always', leakage: 'No risk', example: '11101' },
                { name: 'weekday', type: 'known', classification: 'KNOWN-AT FEATURE', desc: 'Day name', knownAt: 'Always', leakage: 'No risk', example: 'Saturday' },
                { name: 'wday', type: 'known', classification: 'KNOWN-AT FEATURE', desc: 'Day number (1=Saturday)', knownAt: 'Always', leakage: 'No risk', example: '1' },
                { name: 'month', type: 'known', classification: 'KNOWN-AT FEATURE', desc: 'Month number', knownAt: 'Always', leakage: 'No risk', example: '1' },
                { name: 'year', type: 'known', classification: 'KNOWN-AT FEATURE', desc: 'Year', knownAt: 'Always', leakage: 'No risk', example: '2011' },
                { name: 'event_name_1', type: 'known', classification: 'KNOWN-AT FEATURE', desc: 'Primary event name', knownAt: 'Known in advance', leakage: 'No risk', example: 'SuperBowl' },
                { name: 'event_type_1', type: 'known', classification: 'KNOWN-AT FEATURE', desc: 'Primary event type', knownAt: 'Known in advance', leakage: 'No risk', example: 'Sporting' },
                { name: 'event_name_2', type: 'known', classification: 'KNOWN-AT FEATURE', desc: 'Secondary event name', knownAt: 'Known in advance', leakage: 'No risk', example: "Valentine's Day" },
                { name: 'event_type_2', type: 'known', classification: 'KNOWN-AT FEATURE', desc: 'Secondary event type', knownAt: 'Known in advance', leakage: 'No risk', example: 'Cultural' },
                { name: 'snap_CA/TX/WI', type: 'known', classification: 'KNOWN-AT FEATURE', desc: 'SNAP eligibility by state (0/1)', knownAt: 'Known in advance', leakage: 'No risk', example: '1 or 0' }
              ],
              warnings: [
                { title: 'All Calendar Features Are Safe', text: 'Every field is derived from date or official calendars. ALL safe for forecasting.', safe: true },
                { title: 'Event Name ‚â† Event Impact', text: 'Event NAMES are known, but event IMPACT on sales is NOT. Model the pattern, don\'t use realized sales.' },
                { title: 'Multiple Events Per Day', text: 'Some dates have TWO events (event_name_1 and event_name_2). Account for both in features.' }
              ]
            },
            prices: {
              name: 'sell_prices.csv',
              icon: <DollarSign className="w-6 h-6" />,
              color: colors.danger,
              role: 'DYNAMIC FEATURES (UNKNOWN)',
              shape: '6,841,121 rows √ó 4 columns',
              keyPoint: 'Prices change weekly. CRITICAL: Watch for leakage! You cannot use future prices.',
              fields: [
                { name: 'store_id', type: 'static', classification: 'JOIN KEY', desc: 'Store where product is sold', knownAt: 'Always', leakage: 'No risk', example: 'CA_1' },
                { name: 'item_id', type: 'static', classification: 'JOIN KEY', desc: 'Product ID', knownAt: 'Always', leakage: 'No risk', example: 'FOODS_3_090' },
                { name: 'wm_yr_wk', type: 'dynamic', classification: 'JOIN KEY (TIME-VARYING)', desc: 'Walmart week ID for joining', knownAt: 'Depends on forecast date', leakage: 'CRITICAL', example: '11101' },
                { name: 'sell_price', type: 'dynamic', classification: 'DYNAMIC FEATURE', desc: 'Weekly price. Missing = not sold.', knownAt: 'UNKNOWN for future', leakage: 'HIGH RISK', example: '1.97' }
              ],
              warnings: [
                { title: 'üö® THE CRITICAL LEAKAGE RISK', text: 'Prices are DYNAMIC and UNKNOWN at forecast time. You CANNOT use next week\'s price. Use: (1) LAGGED prices, (2) PLANNED promotional prices, or (3) FORECASTED prices.', critical: true },
                { title: 'Weekly Granularity, Daily Sales', text: 'Prices are per week (constant for 7 days), but sales are daily. Each day in a week gets the same price.' },
                { title: 'Missing Prices Mean Something', text: 'If sell_price is missing, the product was NOT sold that week. Consider encoding as "product_available" feature.' },
                { title: 'Prices Change Over Time', text: 'Same item at same store can have different prices due to: seasonal adjustments, clearance, promotions, or permanent changes.' }
              ]
            }
          };

          const TypeBadge = ({ type }) => {
            const config = {
              static: { bg: colors.success, text: 'STATIC' },
              known: { bg: colors.purple, text: 'KNOWN-AT' },
              dynamic: { bg: colors.danger, text: 'DYNAMIC' },
              target: { bg: colors.dark, text: 'TARGET' }
            };
            const c = config[type];
            return <span className="text-xs px-2 py-1 rounded text-white font-bold" style={{ backgroundColor: c.bg }}>{c.text}</span>;
          };

          return (
            <div className="space-y-6">
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <p className="text-gray-700 text-lg">Click any table to explore its fields, see examples, and understand the warnings.</p>
              </div>

              {/* Table Cards */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {Object.entries(tables).map(([id, table]) => (
                  <div
                    key={id}
                    onClick={() => setSelectedTable(selectedTable === id ? null : id)}
                    className={`bg-white rounded-xl p-5 shadow-lg cursor-pointer transition-all hover:shadow-xl border-2 ${selectedTable === id ? 'ring-2 ring-offset-2' : ''}`}
                    style={{ borderColor: table.color, '--tw-ring-color': table.color }}
                  >
                    <div className="flex items-center gap-3 mb-2">
                      <div style={{ color: table.color }}>{table.icon}</div>
                      <div className="font-bold" style={{ color: colors.dark }}>{table.name}</div>
                    </div>
                    <div className="text-xs font-bold mb-2 px-2 py-1 rounded inline-block" style={{ backgroundColor: `${table.color}20`, color: table.color }}>{table.role}</div>
                    <div className="text-xs text-gray-500 mb-2">{table.shape}</div>
                    <div className="text-xs text-gray-400">{selectedTable === id ? '‚ñº Click to collapse' : '‚ñ∂ Click to expand'}</div>
                  </div>
                ))}
              </div>

              {/* Expanded Table Detail */}
              {selectedTable && (
                <div className="bg-white rounded-xl p-6 shadow-xl border-t-4" style={{ borderColor: tables[selectedTable].color }}>
                  <div className="mb-4 p-3 rounded-lg" style={{ backgroundColor: `${tables[selectedTable].color}10` }}>
                    <span className="font-semibold">üí° </span>{tables[selectedTable].keyPoint}
                  </div>

                  {/* Warnings */}
                  {tables[selectedTable].warnings.map((warning, idx) => (
                    <div key={idx} className="mb-4 p-3 rounded-lg flex items-start gap-2" style={{ backgroundColor: warning.critical ? `${colors.danger}15` : warning.safe ? `${colors.success}15` : 'rgb(254 243 199)', borderLeft: `4px solid ${warning.critical ? colors.danger : warning.safe ? colors.success : '#f59e0b'}` }}>
                      <AlertTriangle className="w-4 h-4 flex-shrink-0 mt-0.5" style={{ color: warning.critical ? colors.danger : warning.safe ? colors.success : '#f59e0b' }} />
                      <div>
                        <div className="font-bold text-sm">{warning.title}</div>
                        <div className="text-sm text-gray-700">{warning.text}</div>
                      </div>
                    </div>
                  ))}

                  {/* Fields Table */}
                  <h4 className="font-bold mb-3" style={{ color: colors.dark }}>Fields</h4>
                  <div className="overflow-x-auto">
                    <table className="w-full text-sm border-collapse">
                      <thead>
                        <tr className="bg-gray-50">
                          <th className="text-left p-2 border-b font-bold">Field</th>
                          <th className="text-left p-2 border-b font-bold">Type</th>
                          <th className="text-left p-2 border-b font-bold">Description</th>
                          <th className="text-left p-2 border-b font-bold">Known At</th>
                          <th className="text-left p-2 border-b font-bold">Leakage</th>
                          <th className="text-left p-2 border-b font-bold">Example</th>
                        </tr>
                      </thead>
                      <tbody>
                        {tables[selectedTable].fields.map((field, idx) => (
                          <tr key={idx} className="hover:bg-gray-50">
                            <td className="p-2 border-b"><code className="font-bold">{field.name}</code></td>
                            <td className="p-2 border-b"><TypeBadge type={field.type} /></td>
                            <td className="p-2 border-b text-gray-600">{field.desc}</td>
                            <td className="p-2 border-b text-xs">{field.knownAt}</td>
                            <td className="p-2 border-b text-xs" style={{ color: field.leakage.includes('HIGH') || field.leakage.includes('CRITICAL') ? colors.danger : colors.success }}>{field.leakage}</td>
                            <td className="p-2 border-b"><code className="text-xs text-gray-500">{field.example}</code></td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              )}

              <TransitionCTA text="You understand the data. Now let's transform it" onClick={() => setActiveTab('transform')} />
            </div>
          );
        };

        // ==================== INTERACTIVE TRANSFORMATION VISUALIZER (from original) ====================
        const TransformationVisualizer = () => {
          const [hoveredField, setHoveredField] = useState(null);
          const [activeTab, setActiveTab] = useState('mapping');

          const rawFields = [
            { id: 'item_id', name: 'item_id', file: 'sales_train.csv', example: 'FOODS_3_090', mapsTo: ['unique_id'], color: colors.light },
            { id: 'store_id', name: 'store_id', file: 'sales_train.csv', example: 'CA_1', mapsTo: ['unique_id'], color: colors.light },
            { id: 'dept_id', name: 'dept_id', file: 'sales_train.csv', example: 'FOODS_3', mapsTo: ['dept_id'], color: colors.gray },
            { id: 'cat_id', name: 'cat_id', file: 'sales_train.csv', example: 'FOODS', mapsTo: ['cat_id'], color: colors.gray },
            { id: 'state_id', name: 'state_id', file: 'sales_train.csv', example: 'CA', mapsTo: ['state_id'], color: colors.gray },
            { id: 'd_cols', name: 'd_1 ... d_1941', file: 'sales_train.csv', example: '3, 0, 2, ...', mapsTo: ['y'], color: colors.dark },
            { id: 'calendar_date', name: 'date', file: 'calendar.csv', example: '2011-01-29', mapsTo: ['ds'], color: colors.accent },
            { id: 'calendar_d', name: 'd (d_1, d_2...)', file: 'calendar.csv', example: 'd_1', mapsTo: ['ds'], color: colors.accent },
          ];

          const transformedFields = [
            { id: 'unique_id', name: 'unique_id', desc: 'Unique series identifier', example: 'FOODS_3_090_CA_1', from: ['item_id', 'store_id'], color: colors.primary, required: true },
            { id: 'ds', name: 'ds', desc: 'Date/timestamp', example: '2011-01-29', from: ['calendar_date', 'calendar_d', 'd_cols'], color: colors.accent, required: true },
            { id: 'y', name: 'y', desc: 'Target variable (sales)', example: '3', from: ['d_cols'], color: colors.dark, required: true },
            { id: 'dept_id', name: 'dept_id', desc: 'Department (static feature)', example: 'FOODS_3', from: ['dept_id'], color: colors.gray, required: false },
            { id: 'cat_id', name: 'cat_id', desc: 'Category (static feature)', example: 'FOODS', from: ['cat_id'], color: colors.gray, required: false },
            { id: 'state_id', name: 'state_id', desc: 'State (static feature)', example: 'CA', from: ['state_id'], color: colors.gray, required: false },
          ];

          const isHighlighted = (fieldId, side) => {
            if (!hoveredField) return false;
            if (side === 'raw') {
              if (hoveredField.side === 'raw' && hoveredField.id === fieldId) return true;
              if (hoveredField.side === 'transformed') {
                const transformedField = transformedFields.find(f => f.id === hoveredField.id);
                return transformedField?.from.includes(fieldId);
              }
            } else {
              if (hoveredField.side === 'transformed' && hoveredField.id === fieldId) return true;
              if (hoveredField.side === 'raw') {
                const rawField = rawFields.find(f => f.id === hoveredField.id);
                return rawField?.mapsTo.includes(fieldId);
              }
            }
            return false;
          };

          return (
            <div>
              {/* Tab Navigation */}
              <div className="flex gap-2 mb-4">
                {[
                  { id: 'mapping', label: 'üîó Field Mapping' },
                  { id: 'flow', label: 'üìä Data Flow' }
                ].map(tab => (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className="px-4 py-2 rounded-lg text-sm font-medium transition-all"
                    style={{
                      backgroundColor: activeTab === tab.id ? colors.accent : 'rgba(139, 139, 139, 0.1)',
                      color: activeTab === tab.id ? 'white' : colors.gray
                    }}
                  >
                    {tab.label}
                  </button>
                ))}
              </div>

              {activeTab === 'mapping' && (
                <div className="grid grid-cols-1 lg:grid-cols-11 gap-4">
                  {/* Raw Fields Column */}
                  <div className="lg:col-span-5">
                    <div className="text-sm font-bold mb-3 flex items-center gap-2" style={{ color: colors.gray }}>
                      <span>üìÅ RAW M5 FIELDS</span>
                    </div>
                    <div className="space-y-2">
                      {rawFields.map(field => (
                        <div
                          key={field.id}
                          className="p-3 rounded-lg cursor-pointer transition-all duration-200"
                          style={{
                            backgroundColor: isHighlighted(field.id, 'raw') 
                              ? `${field.color}30` 
                              : 'rgba(139, 139, 139, 0.05)',
                            border: isHighlighted(field.id, 'raw') 
                              ? `2px solid ${field.color}` 
                              : '2px solid transparent',
                            transform: isHighlighted(field.id, 'raw') ? 'scale(1.02)' : 'scale(1)'
                          }}
                          onMouseEnter={() => setHoveredField({ id: field.id, side: 'raw' })}
                          onMouseLeave={() => setHoveredField(null)}
                        >
                          <div className="flex justify-between items-start">
                            <div>
                              <code className="font-bold text-sm" style={{ color: colors.dark }}>{field.name}</code>
                              <div className="text-xs text-gray-500 mt-1">{field.file}</div>
                            </div>
                            <code className="text-xs px-2 py-1 rounded" style={{ backgroundColor: 'rgba(139, 139, 139, 0.1)' }}>
                              {field.example}
                            </code>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  {/* Arrow Column */}
                  <div className="lg:col-span-1 flex items-center justify-center">
                    <div className="hidden lg:flex flex-col items-center gap-2">
                      <div className="text-2xl" style={{ color: colors.accent }}>‚Üí</div>
                      <div className="text-xs text-center" style={{ color: colors.gray }}>load_m5()</div>
                      <div className="text-2xl" style={{ color: colors.accent }}>‚Üí</div>
                    </div>
                    <div className="lg:hidden text-center py-4">
                      <div className="text-2xl" style={{ color: colors.accent }}>‚Üì</div>
                      <div className="text-xs" style={{ color: colors.gray }}>load_m5()</div>
                    </div>
                  </div>

                  {/* Transformed Fields Column */}
                  <div className="lg:col-span-5">
                    <div className="text-sm font-bold mb-3 flex items-center gap-2" style={{ color: colors.primary }}>
                      <span>üîë TSFORGE TRANSFORMED SCHEMA</span>
                    </div>
                    <div className="space-y-2">
                      {transformedFields.map(field => (
                        <div
                          key={field.id}
                          className="p-3 rounded-lg cursor-pointer transition-all duration-200"
                          style={{
                            backgroundColor: isHighlighted(field.id, 'transformed') 
                              ? `${field.color}30` 
                              : 'rgba(139, 139, 139, 0.05)',
                            border: isHighlighted(field.id, 'transformed') 
                              ? `2px solid ${field.color}` 
                              : '2px solid transparent',
                            transform: isHighlighted(field.id, 'transformed') ? 'scale(1.02)' : 'scale(1)'
                          }}
                          onMouseEnter={() => setHoveredField({ id: field.id, side: 'transformed' })}
                          onMouseLeave={() => setHoveredField(null)}
                        >
                          <div className="flex justify-between items-start">
                            <div>
                              <div className="flex items-center gap-2">
                                <code className="font-bold text-sm" style={{ color: colors.dark }}>{field.name}</code>
                                {field.required && (
                                  <span className="text-xs px-2 py-0.5 rounded text-white" style={{ backgroundColor: colors.primary }}>required</span>
                                )}
                              </div>
                              <div className="text-xs text-gray-500 mt-1">{field.desc}</div>
                            </div>
                            <code className="text-xs px-2 py-1 rounded" style={{ backgroundColor: `${field.color}20`, color: field.color }}>
                              {field.example}
                            </code>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              )}

              {activeTab === 'flow' && (
                <div className="space-y-4">
                  {/* Visual flow diagram */}
                  <div className="p-4 rounded-lg" style={{ backgroundColor: 'rgba(29, 31, 86, 0.03)' }}>
                    {/* Row 1: unique_id creation */}
                    <div className="flex items-center gap-3 mb-4 flex-wrap">
                      <div className="flex gap-2">
                        <code className="px-3 py-2 rounded text-sm font-bold" style={{ backgroundColor: `${colors.light}30`, border: `2px solid ${colors.light}` }}>item_id</code>
                        <span className="text-xl font-bold" style={{ color: colors.gray }}>+</span>
                        <code className="px-3 py-2 rounded text-sm font-bold" style={{ backgroundColor: `${colors.light}30`, border: `2px solid ${colors.light}` }}>store_id</code>
                      </div>
                      <ArrowRight className="w-6 h-6" style={{ color: colors.accent }} />
                      <code className="px-3 py-2 rounded text-sm font-bold text-white" style={{ backgroundColor: colors.primary }}>unique_id</code>
                      <span className="text-sm text-gray-500 ml-2">FOODS_3_090 + CA_1 ‚Üí FOODS_3_090_CA_1</span>
                    </div>

                    {/* Row 2: ds creation */}
                    <div className="flex items-center gap-3 mb-4 flex-wrap">
                      <div className="flex gap-2 items-center">
                        <code className="px-3 py-2 rounded text-sm font-bold" style={{ backgroundColor: `${colors.dark}20`, border: `2px solid ${colors.dark}` }}>d_1...d_1941</code>
                        <span className="text-xl font-bold" style={{ color: colors.gray }}>+</span>
                        <code className="px-3 py-2 rounded text-sm font-bold" style={{ backgroundColor: `${colors.accent}20`, border: `2px solid ${colors.accent}` }}>calendar.date</code>
                      </div>
                      <ArrowRight className="w-6 h-6" style={{ color: colors.accent }} />
                      <code className="px-3 py-2 rounded text-sm font-bold text-white" style={{ backgroundColor: colors.accent }}>ds</code>
                      <span className="text-sm text-gray-500 ml-2">d_1 ‚Üí 2011-01-29</span>
                    </div>

                    {/* Row 3: y creation */}
                    <div className="flex items-center gap-3 mb-4 flex-wrap">
                      <code className="px-3 py-2 rounded text-sm font-bold" style={{ backgroundColor: `${colors.dark}20`, border: `2px solid ${colors.dark}` }}>d_X value</code>
                      <ArrowRight className="w-6 h-6" style={{ color: colors.accent }} />
                      <code className="px-3 py-2 rounded text-sm font-bold text-white" style={{ backgroundColor: colors.dark }}>y</code>
                      <span className="text-sm text-gray-500 ml-2">The actual sales count (3, 0, 2, ...)</span>
                    </div>

                    {/* Row 4: Static features */}
                    <div className="flex items-center gap-3 flex-wrap">
                      <div className="flex gap-2">
                        <code className="px-3 py-2 rounded text-sm" style={{ backgroundColor: 'rgba(139, 139, 139, 0.1)' }}>dept_id</code>
                        <code className="px-3 py-2 rounded text-sm" style={{ backgroundColor: 'rgba(139, 139, 139, 0.1)' }}>cat_id</code>
                        <code className="px-3 py-2 rounded text-sm" style={{ backgroundColor: 'rgba(139, 139, 139, 0.1)' }}>state_id</code>
                      </div>
                      <ArrowRight className="w-6 h-6" style={{ color: colors.gray }} />
                      <span className="text-sm" style={{ color: colors.gray }}>Passed through as static features</span>
                    </div>
                  </div>

                  {/* Shape transformation note */}
                  <div className="flex items-center gap-4 p-4 rounded-lg" style={{ backgroundColor: `${colors.primary}10`, border: `1px solid ${colors.primary}` }}>
                    <div className="text-center">
                      <div className="text-2xl font-bold" style={{ color: colors.dark }}>30,490</div>
                      <div className="text-xs text-gray-500">rows</div>
                    </div>
                    <div className="text-center">
                      <div className="text-lg font-bold" style={{ color: colors.gray }}>√ó</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl font-bold" style={{ color: colors.dark }}>1,941</div>
                      <div className="text-xs text-gray-500">d_X cols</div>
                    </div>
                    <ArrowRight className="w-8 h-8" style={{ color: colors.accent }} />
                    <div className="text-center">
                      <div className="text-2xl font-bold" style={{ color: colors.primary }}>59,181,490</div>
                      <div className="text-xs text-gray-500">rows (long format)</div>
                    </div>
                  </div>
                </div>
              )}

              {/* Hover hint */}
              <div className="mt-4 text-xs text-center" style={{ color: colors.gray }}>
                üí° Hover over any field to see its mapping relationship
              </div>
            </div>
          );
        };

        // ==================== RESHAPE TAB (with TSForge emphasis) ====================
        const ReshapeTab = ({ setActiveTab }) => {

          return (
            <div className="space-y-6">
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <p className="text-gray-700 text-lg">Forecasting libraries expect a specific format. TSForge's <code className="bg-gray-100 px-2 py-1 rounded">load_m5()</code> handles this transformation automatically.</p>
              </div>

              {/* TSForge Callout */}
              <div className="rounded-xl p-6 shadow-lg" style={{ backgroundColor: `${colors.success}10`, border: `2px solid ${colors.success}` }}>
                <div className="flex items-center gap-2 mb-3">
                  <span className="text-2xl">üöÄ</span>
                  <span className="font-bold text-lg" style={{ color: colors.dark }}>TSForge Does This For You</span>
                </div>
                <div className="bg-gray-900 rounded-lg p-4 mb-4">
                  <code className="text-green-400 text-sm">
                    <span className="text-purple-400">from</span> tsforge.data <span className="text-purple-400">import</span> load_m5<br/><br/>
                    <span className="text-gray-500"># One line does all the transformation!</span><br/>
                    df = load_m5()
                  </code>
                </div>
                <div className="text-sm text-gray-700">
                  <div className="font-bold mb-2" style={{ color: colors.success }}>What load_m5() handles automatically:</div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                    <div>‚úÖ Creates <code className="bg-white px-1 rounded">unique_id</code> from item_id + store_id</div>
                    <div>‚úÖ Melts wide format to long format</div>
                    <div>‚úÖ Joins calendar to convert d_X ‚Üí actual dates</div>
                    <div>‚úÖ Renames sales values to <code className="bg-white px-1 rounded">y</code></div>
                    <div>‚úÖ Preserves static features (dept_id, cat_id, state_id)</div>
                  </div>
                </div>
                <div className="mt-4 p-3 rounded-lg bg-white text-sm">
                  üí° Understanding the transformation helps you debug issues and customize for your needs.
                </div>
              </div>

              {/* Interactive Field Mapping - Using the original TransformationVisualizer */}
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <h3 className="text-xl font-bold mb-4" style={{ color: colors.dark }}>Interactive Schema Mapping</h3>
                <TransformationVisualizer />
              </div>

              {/* Before/After Tables */}
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <h3 className="text-xl font-bold mb-4" style={{ color: colors.dark }}>Before & After: Actual Data</h3>
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <div>
                    <div className="flex items-center gap-2 mb-3">
                      <span className="px-3 py-1 rounded text-sm font-bold text-white bg-gray-500">BEFORE</span>
                      <span className="text-sm text-gray-500">Wide format (1 row per item-store)</span>
                    </div>
                    <div className="overflow-x-auto">
                      <table className="text-xs w-full border-collapse">
                        <thead><tr className="bg-gray-100"><th className="border p-2">item_id</th><th className="border p-2">store_id</th><th className="border p-2">dept_id</th><th className="border p-2">d_1</th><th className="border p-2">d_2</th><th className="border p-2">d_3</th><th className="border p-2 text-gray-400">...</th></tr></thead>
                        <tbody>
                          <tr><td className="border p-2">FOODS_3_090</td><td className="border p-2">CA_1</td><td className="border p-2">FOODS_3</td><td className="border p-2 text-center font-bold">3</td><td className="border p-2 text-center font-bold">0</td><td className="border p-2 text-center font-bold">2</td><td className="border p-2 text-center text-gray-400">...</td></tr>
                          <tr><td className="border p-2">FOODS_3_090</td><td className="border p-2">CA_2</td><td className="border p-2">FOODS_3</td><td className="border p-2 text-center font-bold">1</td><td className="border p-2 text-center font-bold">2</td><td className="border p-2 text-center font-bold">0</td><td className="border p-2 text-center text-gray-400">...</td></tr>
                        </tbody>
                      </table>
                    </div>
                    <div className="text-xs text-gray-500 mt-2">üìä 30,490 rows √ó 1,947 columns</div>
                  </div>
                  <div>
                    <div className="flex items-center gap-2 mb-3">
                      <span className="px-3 py-1 rounded text-sm font-bold text-white" style={{ backgroundColor: colors.success }}>AFTER</span>
                      <span className="text-sm text-gray-500">Long format (1 row per observation)</span>
                    </div>
                    <div className="overflow-x-auto">
                      <table className="text-xs w-full border-collapse">
                        <thead><tr style={{ backgroundColor: `${colors.success}20` }}><th className="border p-2">unique_id</th><th className="border p-2">ds</th><th className="border p-2">y</th><th className="border p-2">dept_id</th></tr></thead>
                        <tbody>
                          <tr><td className="border p-2 font-mono">FOODS_3_090_CA_1</td><td className="border p-2">2011-01-29</td><td className="border p-2 text-center font-bold">3</td><td className="border p-2">FOODS_3</td></tr>
                          <tr><td className="border p-2 font-mono">FOODS_3_090_CA_1</td><td className="border p-2">2011-01-30</td><td className="border p-2 text-center font-bold">0</td><td className="border p-2">FOODS_3</td></tr>
                          <tr><td className="border p-2 font-mono">FOODS_3_090_CA_1</td><td className="border p-2">2011-01-31</td><td className="border p-2 text-center font-bold">2</td><td className="border p-2">FOODS_3</td></tr>
                          <tr className="text-gray-400"><td className="border p-2 text-center" colSpan="4">... 59M+ more rows ...</td></tr>
                        </tbody>
                      </table>
                    </div>
                    <div className="text-xs mt-2" style={{ color: colors.success }}>üìä 59,181,490 rows √ó ~6 columns</div>
                  </div>
                </div>
              </div>

              {/* Why This Matters */}
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <h3 className="text-lg font-bold mb-3" style={{ color: colors.dark }}>Why This Transformation Matters</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                  <div className="flex items-start gap-2">
                    <CheckCircle className="w-5 h-5 flex-shrink-0" style={{ color: colors.success }} />
                    <div><div className="font-semibold">Standard Schema = Portable Code</div><div className="text-gray-600">The (unique_id, ds, y) format works with Nixtla, statsforecast, Prophet, and most libraries.</div></div>
                  </div>
                  <div className="flex items-start gap-2">
                    <CheckCircle className="w-5 h-5 flex-shrink-0" style={{ color: colors.success }} />
                    <div><div className="font-semibold">Long Format = Proper Time Series</div><div className="text-gray-600">Each row is one observation. Enables lag features, rolling windows, and temporal validation.</div></div>
                  </div>
                </div>
              </div>

              <TransitionCTA text="Use the cheat sheet to validate your work" onClick={() => setActiveTab('cheatsheet')} />
            </div>
          );
        };

        // ==================== CHEAT SHEET TAB (original design) ====================
        const CheatSheetTab = ({ setActiveTab }) => {
          return (
            <div className="space-y-6">
              {/* Complete M5 Column Reference */}
              <div className="bg-white rounded-xl p-8 shadow-lg">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">üìã Complete M5 Column Reference</h2>
                <p className="text-gray-700 mb-6">
                  Use this as your quick reference when building features. Every single column in the M5 dataset 
                  is classified here by type. Bookmark this page and refer back when you're unsure about a field's availability.
                </p>
                
                <div className="space-y-6">
                  {/* Static Columns */}
                  <div className="p-5 rounded-lg" style={{ borderLeft: `4px solid ${colors.light}`, backgroundColor: `${colors.light}15` }}>
                    <div className="flex items-center gap-2 mb-3">
                      <CheckCircle className="w-5 h-5" style={{ color: colors.primary }} />
                      <h4 className="text-lg font-bold" style={{ color: colors.dark }}>STATIC Columns (5 total)</h4>
                    </div>
                    <div className="text-sm mb-3" style={{ color: colors.primary }}>
                      ‚úì Never change over time ‚Ä¢ ‚úì Safe to join anytime ‚Ä¢ ‚úì No leakage risk
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                      {['item_id', 'dept_id', 'cat_id', 'store_id', 'state_id'].map(col => (
                        <code key={col} className="bg-white px-3 py-2 rounded text-xs font-bold text-center" style={{ border: `2px solid ${colors.light}`, color: colors.dark }}>
                          {col}
                        </code>
                      ))}
                    </div>
                    <div className="text-xs mt-3 italic" style={{ color: colors.primary }}>
                      Found in: sales_train.csv (all 5), sell_prices.csv (item_id, store_id)
                    </div>
                  </div>

                  {/* Known-At-Time Columns */}
                  <div className="p-5 rounded-lg" style={{ borderLeft: `4px solid ${colors.purple}`, backgroundColor: `${colors.purple}10` }}>
                    <div className="flex items-center gap-2 mb-3">
                      <Calendar className="w-5 h-5" style={{ color: colors.purple }} />
                      <h4 className="text-lg font-bold" style={{ color: colors.dark }}>KNOWN-AT-TIME Columns (11 total)</h4>
                    </div>
                    <div className="text-sm mb-3" style={{ color: colors.purple }}>
                      ‚úì Known in advance ‚Ä¢ ‚úì Safe for forecasting ‚Ä¢ ‚úì Calendar-based
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                      {['date', 'wday', 'weekday', 'month', 'year', 'event_name_1', 'event_type_1', 'event_name_2', 'event_type_2', 'snap_CA', 'snap_TX', 'snap_WI'].map(col => (
                        <code key={col} className="bg-white px-3 py-2 rounded text-xs font-bold text-center" style={{ border: `2px solid ${colors.purple}`, color: colors.dark }}>
                          {col}
                        </code>
                      ))}
                    </div>
                    <div className="text-xs mt-3 italic" style={{ color: colors.purple }}>
                      Found in: calendar.csv (all fields except wm_yr_wk which is used for joining)
                    </div>
                  </div>

                  {/* Dynamic (Unknown) Columns */}
                  <div className="p-5 rounded-lg" style={{ borderLeft: `4px solid ${colors.accent}`, backgroundColor: `${colors.accent}10` }}>
                    <div className="flex items-center gap-2 mb-3">
                      <AlertTriangle className="w-5 h-5" style={{ color: colors.accent }} />
                      <h4 className="text-lg font-bold" style={{ color: colors.dark }}>DYNAMIC (Unknown) Columns (2 total)</h4>
                    </div>
                    <div className="text-sm mb-3" style={{ color: colors.accent }}>
                      ‚ö†Ô∏è Changes over time ‚Ä¢ ‚ö†Ô∏è NOT known at forecast time ‚Ä¢ ‚ö†Ô∏è HIGH leakage risk
                    </div>
                    <div className="grid grid-cols-2 gap-2">
                      {['sell_price', 'wm_yr_wk'].map(col => (
                        <code key={col} className="bg-white px-3 py-2 rounded text-xs font-bold text-center" style={{ border: `2px solid ${colors.accent}`, color: colors.dark }}>
                          {col}
                        </code>
                      ))}
                    </div>
                    <div className="text-xs mt-3 italic" style={{ color: colors.accent }}>
                      Found in: sell_prices.csv (both), calendar.csv (wm_yr_wk - used as join key)
                    </div>
                    <div className="rounded p-3 mt-3" style={{ backgroundColor: `${colors.accent}15`, border: `1px solid ${colors.accent}` }}>
                      <div className="text-xs font-bold mb-1" style={{ color: colors.dark }}>üö® CRITICAL WARNING</div>
                      <div className="text-xs" style={{ color: colors.accent }}>
                        <strong>sell_price</strong> is THE most dangerous column in M5. You CANNOT use future prices. 
                        Use lagged prices, planned promotional prices, or price forecasts instead.
                      </div>
                    </div>
                  </div>

                  {/* Target Columns */}
                  <div className="p-5 rounded-lg" style={{ borderLeft: `4px solid ${colors.dark}`, backgroundColor: `${colors.dark}10` }}>
                    <div className="flex items-center gap-2 mb-3">
                      <AlertTriangle className="w-5 h-5" style={{ color: colors.dark }} />
                      <h4 className="text-lg font-bold" style={{ color: colors.dark }}>TARGET Columns (1,941 total)</h4>
                    </div>
                    <div className="text-sm mb-3" style={{ color: colors.purple }}>
                      üéØ What you're predicting ‚Ä¢ ‚ö†Ô∏è Can use past as lags ‚Ä¢ ‚ö†Ô∏è NEVER use future values
                    </div>
                    <div className="bg-white px-4 py-3 rounded" style={{ border: `2px solid ${colors.dark}` }}>
                      <code className="text-sm font-bold" style={{ color: colors.dark }}>
                        d_1, d_2, d_3, ..., d_1939, d_1940, d_1941
                      </code>
                      <div className="text-xs mt-2" style={{ color: colors.purple }}>
                        Daily unit sales from 2011-01-29 through 2016-06-19 (1,941 days)
                      </div>
                    </div>
                    <div className="text-xs mt-3 italic" style={{ color: colors.purple }}>
                      Found in: sales_train.csv (1,941 columns, one per day)
                    </div>
                    <div className="rounded p-3 mt-3" style={{ backgroundColor: `${colors.danger}10`, border: `1px solid ${colors.danger}` }}>
                      <div className="text-xs font-bold mb-1" style={{ color: colors.danger }}>üö® LEAKAGE EXAMPLE</div>
                      <div className="text-xs" style={{ color: '#8b0000' }}>
                        To forecast <strong>d_100</strong>, you can ONLY use <strong>d_1...d_99</strong> as features. 
                        Using d_100 or any future d_X values is data leakage and will cause production failure.
                      </div>
                    </div>
                  </div>
                </div>

                <div className="mt-6 rounded-lg p-4" style={{ backgroundColor: `${colors.primary}10`, border: `2px solid ${colors.primary}` }}>
                  <div className="text-sm font-bold mb-2" style={{ color: colors.dark }}>üí° Quick Reference Summary</div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-xs" style={{ color: colors.accent }}>
                    <div><strong>Total columns:</strong> 1,959 (5 static + 11 known-at + 2 dynamic + 1,941 target)</div>
                    <div><strong>Safe to use:</strong> Static + Known-At-Time = 16 columns</div>
                    <div><strong>Requires care:</strong> Dynamic (2) - must use lags or plans</div>
                    <div><strong>Target only:</strong> d_1...d_1941 - can create lag features from past values</div>
                  </div>
                </div>
              </div>

              {/* Quick Decision Tree */}
              <div className="rounded-xl p-8 shadow-lg" style={{ background: 'linear-gradient(135deg, rgba(83, 180, 230, 0.1) 0%, rgba(45, 66, 167, 0.1) 100%)', border: `4px solid ${colors.accent}` }}>
                <h3 className="text-2xl font-bold mb-6" style={{ color: colors.dark }}>üéØ Decision Tree: Can I Use This Column?</h3>
                
                <div className="space-y-4">
                  <div className="bg-white rounded-lg p-5" style={{ border: `2px solid ${colors.light}` }}>
                    <div className="font-bold text-lg mb-2" style={{ color: colors.dark }}>‚úÖ YES - Use it directly</div>
                    <div className="text-sm mb-2" style={{ color: colors.gray }}>
                      <strong>If the column is:</strong>
                    </div>
                    <ul className="text-sm space-y-1 ml-4" style={{ color: colors.accent }}>
                      <li>‚Ä¢ Any of the 5 STATIC columns (item_id, dept_id, cat_id, store_id, state_id)</li>
                      <li>‚Ä¢ Any of the 11 KNOWN-AT-TIME columns from calendar.csv</li>
                      <li>‚Ä¢ A date-derived feature (weekday, month, year, etc.)</li>
                    </ul>
                    <div className="text-xs mt-2 italic" style={{ color: colors.light }}>
                      These 16 columns are always safe. No special handling needed.
                    </div>
                  </div>

                  <div className="bg-white rounded-lg p-5" style={{ border: `2px solid ${colors.accent}` }}>
                    <div className="font-bold text-lg mb-2" style={{ color: colors.dark }}>‚ö†Ô∏è MAYBE - Use with care</div>
                    <div className="text-sm mb-2" style={{ color: colors.gray }}>
                      <strong>If the column is:</strong>
                    </div>
                    <ul className="text-sm space-y-1 ml-4" style={{ color: colors.accent }}>
                      <li>‚Ä¢ <strong>sell_price</strong> - Use LAGGED values (last week's price) or PLANNED promotional prices</li>
                      <li>‚Ä¢ <strong>wm_yr_wk</strong> - Only use for joining; validate temporal ordering</li>
                      <li>‚Ä¢ <strong>d_X (past values)</strong> - Can create LAG features (d_t-1, d_t-7, etc.) but verify temporal split</li>
                    </ul>
                    <div className="text-xs mt-2 italic" style={{ color: colors.accent }}>
                      These require explicit temporal handling. Document your assumptions.
                    </div>
                  </div>

                  <div className="bg-white rounded-lg p-5" style={{ border: `2px solid ${colors.danger}` }}>
                    <div className="font-bold text-lg mb-2" style={{ color: colors.dark }}>‚ùå NO - Do not use</div>
                    <div className="text-sm mb-2" style={{ color: colors.gray }}>
                      <strong>If the column is:</strong>
                    </div>
                    <ul className="text-sm space-y-1 ml-4" style={{ color: colors.danger }}>
                      <li>‚Ä¢ <strong>sell_price</strong> for FUTURE weeks - You don't know next week's actual price</li>
                      <li>‚Ä¢ <strong>d_X</strong> where X ‚â• forecast date - You can't use the future to predict the future</li>
                      <li>‚Ä¢ Any value that would require "peeking" into the future</li>
                    </ul>
                    <div className="text-xs mt-2 italic" style={{ color: colors.danger }}>
                      This is data leakage. Models will look great in validation but fail in production.
                    </div>
                  </div>
                </div>
              </div>

              {/* Common Leakage Patterns */}
              <div className="bg-white rounded-xl p-8 shadow-lg">
                <h3 className="text-2xl font-bold mb-6" style={{ color: colors.dark }}>üö® Common Leakage Patterns to Avoid</h3>
                
                <div className="space-y-4">
                  <div className="flex gap-4 items-start p-4 rounded" style={{ backgroundColor: `${colors.danger}10`, borderLeft: `4px solid ${colors.danger}` }}>
                    <div className="text-2xl">‚ùå</div>
                    <div>
                      <div className="font-bold mb-1" style={{ color: colors.danger }}>Joining prices without time constraint</div>
                      <code className="text-xs px-2 py-1 rounded block mb-2" style={{ backgroundColor: `${colors.danger}15`, color: '#8b0000' }}>
                        df.merge(prices, on=['item_id', 'store_id', 'wm_yr_wk'])  # WRONG
                      </code>
                      <div className="text-sm" style={{ color: '#8b0000' }}>
                        This joins ALL prices, including future prices. Always filter prices to ‚â§ forecast_date.
                      </div>
                    </div>
                  </div>

                  <div className="flex gap-4 items-start p-4 rounded" style={{ backgroundColor: `${colors.danger}10`, borderLeft: `4px solid ${colors.danger}` }}>
                    <div className="text-2xl">‚ùå</div>
                    <div>
                      <div className="font-bold mb-1" style={{ color: colors.danger }}>Using current period sales as feature</div>
                      <code className="text-xs px-2 py-1 rounded block mb-2" style={{ backgroundColor: `${colors.danger}15`, color: '#8b0000' }}>
                        train_df['y'] = train_df['d_100']  # Predicting d_100<br/>
                        train_df['feature'] = train_df['d_100']  # WRONG - using same day
                      </code>
                      <div className="text-sm" style={{ color: '#8b0000' }}>
                        You can't know d_100's sales when forecasting d_100. Only use d_1...d_99.
                      </div>
                    </div>
                  </div>

                  <div className="flex gap-4 items-start p-4 rounded" style={{ backgroundColor: `${colors.danger}10`, borderLeft: `4px solid ${colors.danger}` }}>
                    <div className="text-2xl">‚ùå</div>
                    <div>
                      <div className="font-bold mb-1" style={{ color: colors.danger }}>Rolling window that includes future</div>
                      <code className="text-xs px-2 py-1 rounded block mb-2" style={{ backgroundColor: `${colors.danger}15`, color: '#8b0000' }}>
                        df['rolling_mean_7'] = df['y'].rolling(7, center=True).mean()  # WRONG
                      </code>
                      <div className="text-sm" style={{ color: '#8b0000' }}>
                        center=True uses future values. Use center=False or min_periods to look backward only.
                      </div>
                    </div>
                  </div>

                  <div className="flex gap-4 items-start p-4 rounded" style={{ backgroundColor: `${colors.light}15`, borderLeft: `4px solid ${colors.light}` }}>
                    <div className="text-2xl">‚úÖ</div>
                    <div>
                      <div className="font-bold mb-1" style={{ color: colors.primary }}>Correct lag feature creation</div>
                      <code className="text-xs px-2 py-1 rounded block mb-2" style={{ backgroundColor: `${colors.light}20`, color: colors.dark }}>
                        df['lag_1'] = df.groupby('unique_id')['y'].shift(1)  # Previous day<br/>
                        df['lag_7'] = df.groupby('unique_id')['y'].shift(7)  # Same day last week
                      </code>
                      <div className="text-sm" style={{ color: colors.primary }}>
                        shift() creates proper lags. For d_100, lag_1 gives you d_99, which is safe.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // ==================== MAIN APP ====================
        const M5DatasetExplorer = () => {
          const [activeTab, setActiveTab] = useState('raw');

          return (
            <div className="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 p-6">
              <div className="max-w-5xl mx-auto">
                <div className="rounded-2xl p-6 text-white mb-6 shadow-xl" style={{ background: `linear-gradient(135deg, ${colors.dark} 0%, ${colors.purple} 50%, ${colors.primary} 100%)` }}>
                  <h1 className="text-3xl font-bold">Module 1.7: Understanding the M5 Dataset</h1>
                  <p className="text-sm opacity-80 mt-2">From raw files to forecast-ready format</p>
                </div>

                <JourneyHeader activeTab={activeTab} setActiveTab={setActiveTab} />

                {activeTab === 'raw' && <RawDataTab setActiveTab={setActiveTab} />}
                {activeTab === 'vocabulary' && <VocabularyTab setActiveTab={setActiveTab} />}
                {activeTab === 'explore' && <ExploreTab setActiveTab={setActiveTab} />}
                {activeTab === 'transform' && <ReshapeTab setActiveTab={setActiveTab} />}
                {activeTab === 'cheatsheet' && <CheatSheetTab setActiveTab={setActiveTab} />}
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<M5DatasetExplorer />);
    </script>
</body>
</html>