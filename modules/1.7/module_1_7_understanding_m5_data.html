<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 1.7: Understanding the M5 Dataset</title>
    
    <!-- React and ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Lucide React icons as inline SVGs
        const ChevronDown = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>;
        const ChevronRight = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>;
        const AlertTriangle = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>;
        const CheckCircle = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const Info = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>;
        const Database = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>;
        const Calendar = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const DollarSign = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const Package = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>;

        const M5DatasetExplorer = () => {
          const [selectedTable, setSelectedTable] = useState(null);
          const [expandedSection, setExpandedSection] = useState('overview');

          const tables = {
            sales: {
              name: 'sales_train.csv',
              role: 'TARGET + STATIC IDENTIFIERS',
              color: '#2596be',
              icon: <Database className="w-8 h-8" />,
              description: 'Historical daily unit sales data per product and store',
              shape: '30,490 rows √ó 1,947 columns (6 identifiers + 1,941 daily sales)',
              keyPoint: 'Each row = one item-store combination. Columns d_1...d_1941 are daily unit sales starting from 2011-01-29.',
              fields: [
                {
                  name: 'item_id',
                  type: 'static',
                  classification: 'STATIC IDENTIFIER',
                  desc: 'The id of the product (3,049 unique items)',
                  knownAt: 'Always',
                  leakage: 'No risk',
                  example: 'FOODS_3_090'
                },
                {
                  name: 'dept_id',
                  type: 'static',
                  classification: 'STATIC FEATURE',
                  desc: 'The id of the department the product belongs to (7 departments)',
                  knownAt: 'Always',
                  leakage: 'No risk',
                  example: 'FOODS_3'
                },
                {
                  name: 'cat_id',
                  type: 'static',
                  classification: 'STATIC FEATURE',
                  desc: 'The id of the category the product belongs to (FOODS, HOBBIES, HOUSEHOLD)',
                  knownAt: 'Always',
                  leakage: 'No risk',
                  example: 'FOODS'
                },
                {
                  name: 'store_id',
                  type: 'static',
                  classification: 'STATIC IDENTIFIER',
                  desc: 'The id of the store where the product is sold (10 stores)',
                  knownAt: 'Always',
                  leakage: 'No risk',
                  example: 'CA_3'
                },
                {
                  name: 'state_id',
                  type: 'static',
                  classification: 'STATIC FEATURE',
                  desc: 'The State where the store is located (CA, TX, WI)',
                  knownAt: 'Always',
                  leakage: 'No risk',
                  example: 'CA'
                },
                {
                  name: 'd_1, d_2, ..., d_1941',
                  type: 'target',
                  classification: 'TARGET VARIABLE',
                  desc: 'The number of units sold at day i, starting from 2011-01-29. Each column represents one day.',
                  knownAt: 'Only up to forecast date',
                  leakage: 'HIGH RISK - Never use future sales as features',
                  example: 'd_1=3, d_2=0, d_3=5'
                }
              ],
              warnings: [
                {
                  title: 'Wide Format Alert',
                  content: 'This data comes in WIDE format (days as columns). You MUST reshape to LONG format for modeling: (unique_id, ds, y). The unique_id should combine item_id + store_id.'
                },
                {
                  title: 'Target Column Leakage',
                  content: 'When forecasting d_1900, you can only use d_1...d_1899 as features. Never include future days in training. The target is what you\'re trying to predict, not what you can use as input.'
                },
                {
                  title: 'No Explicit ID Column',
                  content: 'Unlike some datasets, there\'s no single "id" column. You must create unique_id by combining item_id and store_id (e.g., "FOODS_3_090_CA_3").'
                }
              ]
            },
            calendar: {
              name: 'calendar.csv',
              role: 'KNOWN-AT-TIME FEATURES',
              color: '#3a2f7e',
              icon: <Calendar className="w-8 h-8" />,
              description: 'Information about the dates the products are sold',
              shape: '1,969 rows √ó 14 columns (one row per day, covering the full date range)',
              keyPoint: 'This is your master date table. Join to sales data via the date or d_X identifier.',
              fields: [
                {
                  name: 'date',
                  type: 'dynamic',
                  classification: 'TIME IDENTIFIER',
                  desc: 'The date in "y-m-d" format',
                  knownAt: 'Always (future dates are known)',
                  leakage: 'No risk',
                  example: '2011-01-29'
                },
                {
                  name: 'wm_yr_wk',
                  type: 'dynamic',
                  classification: 'TIME GROUPING',
                  desc: 'The id of the week the date belongs to (used for price joins)',
                  knownAt: 'Always',
                  leakage: 'No risk',
                  example: '11101'
                },
                {
                  name: 'weekday',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'The type of the day (Saturday, Sunday, ..., Friday)',
                  knownAt: 'Always (derived from date)',
                  leakage: 'No risk',
                  example: 'Saturday'
                },
                {
                  name: 'wday',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'The id of the weekday, starting from Saturday',
                  knownAt: 'Always (derived from date)',
                  leakage: 'No risk',
                  example: '1'
                },
                {
                  name: 'month',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'The month of the date',
                  knownAt: 'Always (derived from date)',
                  leakage: 'No risk',
                  example: '1'
                },
                {
                  name: 'year',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'The year of the date',
                  knownAt: 'Always (derived from date)',
                  leakage: 'No risk',
                  example: '2011'
                },
                {
                  name: 'event_name_1',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'If the date includes an event, the name of this event (e.g., SuperBowl, Christmas)',
                  knownAt: 'Known in advance (official calendar)',
                  leakage: 'No risk - event names are predetermined',
                  example: 'SuperBowl'
                },
                {
                  name: 'event_type_1',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'If the date includes an event, the type of this event (Cultural, National, Religious, Sporting)',
                  knownAt: 'Known in advance',
                  leakage: 'No risk',
                  example: 'Sporting'
                },
                {
                  name: 'event_name_2',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'If the date includes a second event, the name of this event',
                  knownAt: 'Known in advance (official calendar)',
                  leakage: 'No risk',
                  example: 'Valentine\'s Day'
                },
                {
                  name: 'event_type_2',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'If the date includes a second event, the type of this event',
                  knownAt: 'Known in advance',
                  leakage: 'No risk',
                  example: 'Cultural'
                },
                {
                  name: 'snap_CA',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'Binary variable (0 or 1) indicating whether CA stores allow SNAP purchases on this date',
                  knownAt: 'Known in advance (government calendar)',
                  leakage: 'No risk - SNAP schedules are predetermined',
                  example: '1'
                },
                {
                  name: 'snap_TX',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'Binary variable (0 or 1) indicating whether TX stores allow SNAP purchases on this date',
                  knownAt: 'Known in advance (government calendar)',
                  leakage: 'No risk',
                  example: '0'
                },
                {
                  name: 'snap_WI',
                  type: 'dynamic',
                  classification: 'KNOWN-AT FEATURE',
                  desc: 'Binary variable (0 or 1) indicating whether WI stores allow SNAP purchases on this date',
                  knownAt: 'Known in advance (government calendar)',
                  leakage: 'No risk',
                  example: '1'
                }
              ],
              warnings: [
                {
                  title: 'All Calendar Features Are Known-At-Time',
                  content: 'Every field in this table is either derived from the date itself (weekday, month, year) or comes from official calendars (events, SNAP schedules). These are ALL safe to use for forecasting because they\'re known in advance.'
                },
                {
                  title: 'Event Name ‚â† Event Impact',
                  content: 'While event NAMES are known (we know when SuperBowl happens), the event IMPACT on sales is NOT. Don\'t use realized sales from past SuperBowls directly - model the pattern instead.'
                },
                {
                  title: 'Multiple Events Per Day',
                  content: 'Some dates have TWO events (event_name_1 and event_name_2). Make sure your features account for this - you might need to combine them or create separate indicators.'
                }
              ]
            },
            prices: {
              name: 'sell_prices.csv',
              role: 'DYNAMIC FEATURES (UNKNOWN)',
              color: '#2d42a7',
              icon: <DollarSign className="w-8 h-8" />,
              description: 'Information about the price of products sold per store and date',
              shape: '6,841,121 rows √ó 4 columns (not all item-store-week combinations present)',
              keyPoint: 'Prices change weekly. Join via [store_id + item_id + wm_yr_wk]. CRITICAL: Watch for leakage!',
              fields: [
                {
                  name: 'store_id',
                  type: 'static',
                  classification: 'JOIN KEY',
                  desc: 'The id of the store where the product is sold',
                  knownAt: 'Always',
                  leakage: 'No risk',
                  example: 'CA_1'
                },
                {
                  name: 'item_id',
                  type: 'static',
                  classification: 'JOIN KEY',
                  desc: 'The id of the product',
                  knownAt: 'Always',
                  leakage: 'No risk',
                  example: 'FOODS_3_090'
                },
                {
                  name: 'wm_yr_wk',
                  type: 'dynamic',
                  classification: 'JOIN KEY (TIME-VARYING)',
                  desc: 'The id of the week. Use this to join with calendar.csv to get the date range.',
                  knownAt: 'Depends on forecast date',
                  leakage: 'CRITICAL - Must validate date availability',
                  example: '11101'
                },
                {
                  name: 'sell_price',
                  type: 'dynamic',
                  classification: 'DYNAMIC FEATURE',
                  desc: 'The price of the product for the given week/store (average across seven days). If not available, the product was not sold during that week.',
                  knownAt: 'UNKNOWN for future weeks',
                  leakage: 'HIGH RISK - Cannot use future realized prices',
                  example: '1.97'
                }
              ],
              warnings: [
                {
                  title: 'THE CRITICAL LEAKAGE RISK',
                  content: 'Prices are DYNAMIC and UNKNOWN at forecast time. You CANNOT use next week\'s actual realized price to forecast next week\'s sales. Instead, use: (1) PLANNED promotional prices from merchandising calendars, (2) LAGGED prices (last week\'s price), or (3) FORECASTED prices from a separate price prediction model.'
                },
                {
                  title: 'Weekly Granularity, Daily Sales',
                  content: 'Prices are provided per week (constant for 7 days), but sales are daily. When you join prices to daily sales data, each day in a week gets the same price. This is correct - prices don\'t change mid-week in this dataset.'
                },
                {
                  title: 'Missing Prices Mean Something',
                  content: 'If sell_price is missing for a specific [store_id + item_id + wm_yr_wk], it means the product was NOT sold during that week at that store. This is informative! Consider encoding this as a separate feature (e.g., "product_available").'
                },
                {
                  title: 'Prices Change Over Time',
                  content: 'The same item at the same store can have different prices in different weeks (both in training and test periods). Price changes might be: (1) seasonal adjustments, (2) clearance sales, (3) promotional periods, or (4) permanent price changes.'
                }
              ]
            }
          };

          const conceptCards = [
            {
              id: 'static',
              title: 'STATIC Features',
              color: '#53b4e6',
              icon: <CheckCircle className="w-6 h-6" />,
              definition: 'Attributes that NEVER change over time for a given entity.',
              examples: [
                'item_id',
                'dept_id', 
                'cat_id',
                'store_id',
                'state_id'
              ],
              usage: 'Can be joined to any date without leakage risk.',
              watch: 'Be careful: some things you think are static might actually change (e.g., store square footage after renovations). In M5, these identifiers are truly static.'
            },
            {
              id: 'dynamic',
              title: 'DYNAMIC Features',
              color: '#2d42a7',
              icon: <AlertTriangle className="w-6 h-6" />,
              definition: 'Features that change over time. May or may not be known at forecast time.',
              examples: [
                'sell_price',
                'wm_yr_wk'
              ],
              usage: 'MUST verify availability at forecast time. Often requires lags or external plans.',
              watch: 'This is where most leakage happens. Always ask: "Will I know this value when making the forecast?" For M5, sell_price is the critical dynamic feature that is UNKNOWN at forecast time.'
            },
            {
              id: 'known-at',
              title: 'KNOWN-AT-TIME',
              color: '#3a2f7e',
              icon: <Calendar className="w-6 h-6" />,
              definition: 'Dynamic features that are known in advance (e.g., from a calendar or schedule).',
              examples: [
                'date',
                'wday',
                'weekday',
                'month',
                'year',
                'event_name_1',
                'event_type_1',
                'event_name_2',
                'event_type_2',
                'snap_CA',
                'snap_TX',
                'snap_WI'
              ],
              usage: 'Safe to use for future forecasts because they exist on a predetermined schedule.',
              watch: 'Known EVENT ‚â† Known IMPACT. You know Christmas is coming, but not how much it will boost sales. All calendar.csv fields (except wm_yr_wk used for joining) fall into this category.'
            },
            {
              id: 'target',
              title: 'TARGET Variable',
              color: '#1d1f56',
              icon: <AlertTriangle className="w-6 h-6" />,
              definition: 'The variable you are trying to predict. Must NEVER be used as a feature for the same time period.',
              examples: [
                'd_1',
                'd_2',
                '... (all d_X columns)',
                'd_1941'
              ],
              usage: 'This is what you\'re forecasting. Can use PAST values as lags, but never future or current values.',
              watch: 'The #1 leakage mistake: using d_100 to predict d_100. You can use d_1...d_99 to predict d_100, but not the value you\'re trying to forecast. Create lag features carefully.'
            },
            {
              id: 'leakage',
              title: 'DATA LEAKAGE',
              color: '#c41e3a',
              icon: <AlertTriangle className="w-6 h-6" />,
              definition: 'Using information in training that would not be available at forecast time. This destroys model validity.',
              examples: [
                'Using future sell_price',
                'Using future d_X sales',
                'Using wm_yr_wk from the future',
                'Not properly lagging features'
              ],
              usage: 'PREVENT by asking: "Will I actually know this value when I make the forecast in production?"',
              watch: 'Leakage causes perfect validation scores but 100% failure in production. It\'s invisible in metrics but deadly in deployment. Always validate temporal ordering of your features.'
            }
          ];

          const TableCard = ({ id, table }) => (
            <div
              onClick={() => setSelectedTable(id)}
              className={`cursor-pointer transition-all duration-300 bg-white rounded-xl p-6 border-4 hover:shadow-xl hover:-translate-y-1 ${
                selectedTable === id ? 'ring-4 ring-opacity-50' : ''
              }`}
              style={{ 
                borderColor: table.color,
                ...(selectedTable === id && { '--tw-ring-color': table.color })
              }}
            >
              <div style={{ color: table.color }} className="mb-3">
                {table.icon}
              </div>
              <div className="text-xs font-bold text-gray-500 tracking-wider mb-1">
                {table.role}
              </div>
              <div className="text-xl font-bold mb-2" style={{ color: table.color }}>
                {table.name}
              </div>
              <div className="text-sm text-gray-600 mb-4">
                {table.description}
              </div>
              <div className="text-xs bg-gray-100 rounded-lg px-3 py-2 font-mono">
                {table.shape}
              </div>
            </div>
          );

          const FieldBadge = ({ type }) => {
            const styles = {
              static: { bg: '#53b4e6', text: 'STATIC' },
              dynamic: { bg: '#2d42a7', text: 'DYNAMIC' },
              target: { bg: '#1d1f56', text: 'TARGET' }
            };
            const style = styles[type] || styles.static;
            
            return (
              <span
                className="text-xs font-bold px-2 py-1 rounded-full text-white"
                style={{ backgroundColor: style.bg }}
              >
                {style.text}
              </span>
            );
          };

          const ConceptCard = ({ concept }) => (
            <div
              className="bg-white rounded-xl p-6 border-l-8 shadow-lg"
              style={{ borderColor: concept.color }}
            >
              <div className="flex items-center gap-3 mb-4">
                <div style={{ color: concept.color }}>
                  {concept.icon}
                </div>
                <h3 className="text-xl font-bold" style={{ color: concept.color }}>
                  {concept.title}
                </h3>
              </div>
              
              <div className="space-y-3 text-sm">
                <div>
                  <div className="font-bold text-gray-700 mb-1">Definition:</div>
                  <div className="text-gray-600">{concept.definition}</div>
                </div>
                
                <div>
                  <div className="font-bold text-gray-700 mb-1">
                    {concept.id === 'target' ? 'Target Columns in M5:' : 'M5 Columns in this Category:'}
                  </div>
                  <div className="flex flex-wrap gap-2">
                    {concept.examples.map((ex, i) => (
                      <code 
                        key={i} 
                        className="px-2 py-1 rounded text-xs font-semibold"
                        style={{ 
                          backgroundColor: `${concept.color}20`,
                          color: concept.color,
                          border: `1px solid ${concept.color}40`
                        }}
                      >
                        {ex}
                      </code>
                    ))}
                  </div>
                </div>
                
                <div>
                  <div className="font-bold text-gray-700 mb-1">Usage:</div>
                  <div className="text-gray-600">{concept.usage}</div>
                </div>
                
                <div className="bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded">
                  <div className="font-bold text-yellow-800 text-xs mb-1">‚ö†Ô∏è Watch Out:</div>
                  <div className="text-yellow-700 text-xs">{concept.watch}</div>
                </div>
              </div>
            </div>
          );

          // Color palette
          const colors = {
            primary: '#2596be',      // Bright blue
            dark: '#1d1f56',         // Dark navy
            accent: '#2d42a7',       // Royal blue
            purple: '#3a2f7e',       // Deep purple
            light: '#53b4e6',        // Light blue
            gray: '#8b8b8b'          // Gray
          };

          return (
            <div className="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 p-6">
              <div className="max-w-7xl mx-auto">
                {/* Header */}
                <div 
                  className="rounded-2xl p-8 text-white mb-8 shadow-xl"
                  style={{ background: `linear-gradient(135deg, ${colors.dark} 0%, ${colors.purple} 25%, ${colors.accent} 50%, ${colors.primary} 75%, ${colors.light} 100%)` }}
                >
                  <h1 className="text-4xl font-bold mb-6">Module 1.7: Understanding the M5 Dataset</h1>
                  
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                    <div className="bg-white bg-opacity-20 rounded-lg p-4">
                      <div className="font-bold mb-1">‚ë† Understand Files</div>
                      <div className="text-xs opacity-90">Learn the three M5 files and their roles</div>
                    </div>
                    <div className="bg-white bg-opacity-20 rounded-lg p-4">
                      <div className="font-bold mb-1">‚ë° Classify Fields</div>
                      <div className="text-xs opacity-90">Tag as static, dynamic, or target</div>
                    </div>
                    <div className="bg-white bg-opacity-20 rounded-lg p-4">
                      <div className="font-bold mb-1">‚ë¢ Check Known-At-Time</div>
                      <div className="text-xs opacity-90">Validate feature availability at forecast time</div>
                    </div>
                    <div className="bg-white bg-opacity-20 rounded-lg p-4">
                      <div className="font-bold mb-1">‚ë£ Prevent Leakage</div>
                      <div className="text-xs opacity-90">Never use future information to predict the future</div>
                    </div>
                  </div>
                </div>

                {/* Navigation Tabs */}
                <div className="flex gap-2 mb-6 flex-wrap">
                  {['overview', 'tables', 'concepts', 'cheatsheet'].map(section => (
                    <button
                      key={section}
                      onClick={() => setExpandedSection(section)}
                      className="px-6 py-3 rounded-lg font-semibold transition-all"
                      style={{
                        backgroundColor: expandedSection === section ? colors.accent : 'white',
                        color: expandedSection === section ? 'white' : colors.gray,
                        boxShadow: expandedSection === section ? '0 4px 6px -1px rgba(0, 0, 0, 0.1)' : 'none'
                      }}
                    >
                      {section === 'overview' && 'üìñ Overview'}
                      {section === 'tables' && 'üìä Tables'}
                      {section === 'concepts' && 'üí° Key Concepts'}
                      {section === 'cheatsheet' && 'üìã Cheat Sheet'}
                    </button>
                  ))}
                </div>

                {/* Overview Section */}
                {expandedSection === 'overview' && (
                  <div className="space-y-6">
                    <div className="bg-white rounded-xl p-8 shadow-lg">
                      <h2 className="text-2xl font-bold text-gray-800 mb-4">The M5 Dataset Structure</h2>
                      <p className="text-gray-700 mb-4">
                        The M5 dataset comes from Walmart and contains daily sales data for thousands of items across 
                        multiple stores. It's split into several files, each serving a specific role in the forecasting pipeline.
                      </p>
                      
                      <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                        <div className="font-bold text-blue-800 mb-2">Why This Matters</div>
                        <div className="text-blue-700 text-sm">
                          Understanding how these tables connect and what each field represents is not just academic - 
                          it's the difference between a model that works in notebooks and one that survives production. 
                          Most forecasting failures happen at the data preparation stage, not the modeling stage.
                        </div>
                      </div>

                      <h3 className="text-xl font-bold text-gray-800 mt-6 mb-3">The Three Files</h3>
                      <div className="space-y-3">
                        <div className="flex gap-4 items-start">
                          <div className="bg-blue-100 p-2 rounded">
                            <Database className="w-6 h-6 text-blue-600" />
                          </div>
                          <div>
                            <div className="font-bold text-gray-800">sales_train.csv</div>
                            <div className="text-sm text-gray-600">
                              Historical daily unit sales per product and store (the TARGET). 30,490 item-store combinations √ó 1,941 days starting from 2011-01-29. Contains hierarchical identifiers (item_id, dept_id, cat_id, store_id, state_id).
                            </div>
                          </div>
                        </div>
                        
                        <div className="flex gap-4 items-start">
                          <div className="bg-purple-100 p-2 rounded">
                            <Calendar className="w-6 h-6 text-purple-600" />
                          </div>
                          <div>
                            <div className="font-bold text-gray-800">calendar.csv</div>
                            <div className="text-sm text-gray-600">
                              Information about the dates products are sold. Contains date attributes (weekday, month, year), events (up to 2 events per day), and SNAP eligibility by state. 1,969 rows (one per day).
                            </div>
                          </div>
                        </div>
                        
                        <div className="flex gap-4 items-start">
                          <div className="bg-orange-100 p-2 rounded">
                            <DollarSign className="w-6 h-6 text-orange-600" />
                          </div>
                          <div>
                            <div className="font-bold text-gray-800">sell_prices.csv</div>
                            <div className="text-sm text-gray-600">
                              Information about product prices per store and week. Weekly pricing data (constant for 7 days). 6.8M rows. CRITICAL: prices are dynamic and unknown at forecast time.
                            </div>
                          </div>
                        </div>
                      </div>
                      
                      <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mt-6">
                        <div className="font-bold text-blue-800 mb-2">üí° Note on Hierarchical Data</div>
                        <div className="text-blue-700 text-sm">
                          The sales_train.csv file includes built-in hierarchical identifiers (item_id ‚Üí dept_id ‚Üí cat_id and store_id ‚Üí state_id). 
                          You don't need a separate metadata file - the hierarchy is already embedded in the sales data.
                        </div>
                      </div>

                      {/* Hierarchy Visualization */}
                      <div className="bg-white rounded-xl p-8 shadow-lg mt-8 border-2 border-gray-200">
                        <h3 className="text-2xl font-bold text-gray-800 mb-6">üèóÔ∏è M5 Data Hierarchy</h3>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                          {/* Product Hierarchy */}
                          <div>
                            <div className="text-center mb-4">
                              <div className="inline-block bg-indigo-600 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg">
                                Product Hierarchy
                              </div>
                            </div>
                            
                            <div className="space-y-3">
                              <div className="flex flex-col items-center">
                                <div className="bg-indigo-100 border-3 border-indigo-400 rounded-lg p-4 w-full text-center">
                                  <div className="text-xs font-bold text-indigo-600 mb-1">LEVEL 1: CATEGORY</div>
                                  <code className="text-sm font-bold text-indigo-900">cat_id</code>
                                  <div className="text-xs text-indigo-700 mt-1">3 categories total</div>
                                </div>
                                <div className="w-1 h-6 bg-indigo-300"></div>
                              </div>
                              
                              <div className="flex flex-col items-center">
                                <div className="bg-indigo-100 border-3 border-indigo-400 rounded-lg p-4 w-full text-center">
                                  <div className="text-xs font-bold text-indigo-600 mb-1">LEVEL 2: DEPARTMENT</div>
                                  <code className="text-sm font-bold text-indigo-900">dept_id</code>
                                  <div className="text-xs text-indigo-700 mt-1">7 departments total</div>
                                </div>
                                <div className="w-1 h-6 bg-indigo-300"></div>
                              </div>
                              
                              <div className="flex flex-col items-center">
                                <div className="bg-indigo-100 border-3 border-indigo-400 rounded-lg p-4 w-full text-center">
                                  <div className="text-xs font-bold text-indigo-600 mb-1">LEVEL 3: ITEM</div>
                                  <code className="text-sm font-bold text-indigo-900">item_id</code>
                                  <div className="text-xs text-indigo-700 mt-1">3,049 items total</div>
                                </div>
                              </div>
                            </div>
                            
                            <div className="mt-4 bg-indigo-50 rounded-lg p-3 text-xs text-indigo-800">
                              <strong>Example:</strong><br/>
                              FOODS ‚Üí FOODS_3 ‚Üí FOODS_3_090<br/>
                              <span className="text-indigo-600">(Category ‚Üí Department ‚Üí Item)</span>
                            </div>
                          </div>
                          
                          {/* Location Hierarchy */}
                          <div>
                            <div className="text-center mb-4">
                              <div className="inline-block bg-green-600 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg">
                                Location Hierarchy
                              </div>
                            </div>
                            
                            <div className="space-y-3">
                              <div className="flex flex-col items-center">
                                <div className="bg-green-100 border-3 border-green-400 rounded-lg p-4 w-full text-center">
                                  <div className="text-xs font-bold text-green-600 mb-1">LEVEL 1: STATE</div>
                                  <code className="text-sm font-bold text-green-900">state_id</code>
                                  <div className="text-xs text-green-700 mt-1">3 states: CA, TX, WI</div>
                                </div>
                                <div className="w-1 h-6 bg-green-300"></div>
                              </div>
                              
                              <div className="flex flex-col items-center">
                                <div className="bg-green-100 border-3 border-green-400 rounded-lg p-4 w-full text-center">
                                  <div className="text-xs font-bold text-green-600 mb-1">LEVEL 2: STORE</div>
                                  <code className="text-sm font-bold text-green-900">store_id</code>
                                  <div className="text-xs text-green-700 mt-1">10 stores total</div>
                                </div>
                              </div>
                              
                              <div className="flex flex-col items-center opacity-0">
                                <div className="bg-green-100 border-3 border-green-400 rounded-lg p-4 w-full text-center">
                                  <div className="text-xs font-bold text-green-600 mb-1">PLACEHOLDER</div>
                                </div>
                              </div>
                            </div>
                            
                            <div className="mt-4 bg-green-50 rounded-lg p-3 text-xs text-green-800">
                              <strong>Example:</strong><br/>
                              CA ‚Üí CA_3<br/>
                              <span className="text-green-600">(State ‚Üí Store)</span>
                            </div>
                          </div>
                        </div>
                        
                        {/* Bottom: Final Granularity */}
                        <div className="mt-8 pt-6 border-t-2 border-gray-200">
                          <div className="text-center mb-4">
                            <div className="inline-block bg-purple-600 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg">
                              ‚Üì Combined: Final Forecasting Unit ‚Üì
                            </div>
                          </div>
                          
                          <div className="bg-purple-50 border-3 border-purple-400 rounded-xl p-6 text-center">
                            <div className="text-sm font-bold text-purple-900 mb-2">UNIQUE_ID (Item √ó Store Combination)</div>
                            <code className="text-lg font-bold text-purple-800 bg-white px-4 py-2 rounded border-2 border-purple-300 inline-block">
                              item_id + store_id
                            </code>
                            <div className="text-xs text-purple-700 mt-3">
                              30,490 unique combinations (3,049 items √ó 10 stores)
                            </div>
                            <div className="text-xs text-purple-600 mt-2 italic">
                              Each row in sales_train.csv = one unique item-store combination with 1,941 days of sales
                            </div>
                          </div>
                          
                          <div className="mt-4 bg-yellow-50 border-l-4 border-yellow-400 rounded p-4">
                            <div className="text-sm text-yellow-900">
                              <strong>üí° Why This Matters:</strong> You can forecast at ANY level of this hierarchy:
                            </div>
                            <div className="text-xs text-yellow-800 mt-2 space-y-1">
                              <div>‚Ä¢ <strong>Bottom-up:</strong> Forecast each item-store, then aggregate to dept/category/state</div>
                              <div>‚Ä¢ <strong>Top-down:</strong> Forecast total category sales, then disaggregate to items</div>
                              <div>‚Ä¢ <strong>Middle-out:</strong> Forecast at department level, then reconcile up/down</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Tables Section */}
                {expandedSection === 'tables' && (
                  <div className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      {Object.entries(tables).map(([id, table]) => (
                        <TableCard key={id} id={id} table={table} />
                      ))}
                    </div>

                    {selectedTable ? (
                      <div 
                        className="bg-white rounded-xl p-8 shadow-xl border-4"
                        style={{ borderColor: tables[selectedTable].color }}
                      >
                        <div className="flex items-center gap-4 mb-6 pb-6 border-b-4" style={{ borderColor: tables[selectedTable].color }}>
                          <div style={{ color: tables[selectedTable].color }}>
                            {tables[selectedTable].icon}
                          </div>
                          <div>
                            <div className="text-xs font-bold text-gray-500 tracking-wider mb-1">
                              {tables[selectedTable].role}
                            </div>
                            <h2 className="text-3xl font-bold" style={{ color: tables[selectedTable].color }}>
                              {tables[selectedTable].name}
                            </h2>
                            <div className="text-sm text-gray-600 mt-1">{tables[selectedTable].description}</div>
                          </div>
                        </div>

                        <div 
                          className="rounded-lg p-4 mb-6 font-semibold"
                          style={{ 
                            backgroundColor: `${tables[selectedTable].color}15`,
                            color: tables[selectedTable].color,
                            borderLeft: `4px solid ${tables[selectedTable].color}`
                          }}
                        >
                          üí° {tables[selectedTable].keyPoint}
                        </div>

                        {tables[selectedTable].warnings.map((warning, idx) => (
                          <div key={idx} className="bg-red-50 border-l-4 border-red-500 p-4 mb-4 rounded">
                            <div className="flex items-start gap-3">
                              <AlertTriangle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
                              <div>
                                <div className="font-bold text-red-800 mb-1">{warning.title}</div>
                                <div className="text-sm text-red-700">{warning.content}</div>
                              </div>
                            </div>
                          </div>
                        ))}

                        <div className="space-y-3">
                          <h3 className="text-xl font-bold text-gray-800 mb-4">Fields</h3>
                          {tables[selectedTable].fields.map((field, idx) => (
                            <div 
                              key={idx}
                              className="border-2 border-gray-200 border-l-8 rounded-lg p-4 hover:bg-gray-50 transition-colors"
                              style={{ borderLeftColor: field.type === 'static' ? '#06A77D' : field.type === 'target' ? '#E63946' : '#F77F00' }}
                            >
                              <div className="flex items-center justify-between mb-2 flex-wrap gap-2">
                                <code className="bg-gray-100 px-3 py-1 rounded font-mono font-bold text-sm">
                                  {field.name}
                                </code>
                                <div className="flex gap-2 flex-wrap">
                                  <FieldBadge type={field.type} />
                                  <span className="text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded font-bold">
                                    {field.classification}
                                  </span>
                                </div>
                              </div>
                              <div className="text-sm text-gray-700 mb-2">{field.desc}</div>
                              <div className="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                <div className="bg-blue-50 p-2 rounded">
                                  <span className="font-bold text-blue-800">Known At: </span>
                                  <span className="text-blue-700">{field.knownAt}</span>
                                </div>
                                <div className="bg-purple-50 p-2 rounded">
                                  <span className="font-bold text-purple-800">Leakage Risk: </span>
                                  <span className="text-purple-700">{field.leakage}</span>
                                </div>
                                <div className="bg-gray-100 p-2 rounded font-mono">
                                  <span className="font-bold text-gray-800">Example: </span>
                                  <span className="text-gray-700">{field.example}</span>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    ) : (
                      <div className="bg-white rounded-xl p-16 text-center shadow-lg">
                        <Database className="w-16 h-16 text-gray-400 mx-auto mb-4" />
                        <h3 className="text-2xl font-bold text-gray-600 mb-2">Select a table to explore</h3>
                        <p className="text-gray-500">Click on any table card above to see detailed field information</p>
                      </div>
                    )}
                  </div>
                )}

                {/* Concepts Section */}
                {expandedSection === 'concepts' && (
                  <div className="space-y-6">
                    {/* Core Concepts Box */}
                    <div 
                      className="rounded-xl p-8 text-white shadow-xl"
                      style={{ background: `linear-gradient(135deg, ${colors.dark} 0%, ${colors.purple} 35%, ${colors.accent} 65%, ${colors.primary} 100%)` }}
                    >
                      <div className="flex items-center gap-3 mb-6">
                        <div className="text-4xl">üéØ</div>
                        <h2 className="text-3xl font-bold">Core Concepts</h2>
                      </div>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                        <div className="bg-white bg-opacity-20 rounded-lg p-4" style={{ borderLeft: `4px solid ${colors.light}` }}>
                          <div className="font-bold text-lg mb-2 flex items-center gap-2">
                            <span>‚úì</span>
                            <span>STATIC</span>
                          </div>
                          <div className="text-sm opacity-95">
                            Attributes that never change over time. Always safe to use.
                          </div>
                          <div className="text-xs mt-2 opacity-80 italic">
                            Example: item_id, store_id, dept_id
                          </div>
                        </div>
                        
                        <div className="bg-white bg-opacity-20 rounded-lg p-4" style={{ borderLeft: `4px solid ${colors.purple}` }}>
                          <div className="font-bold text-lg mb-2 flex items-center gap-2">
                            <span>‚úì</span>
                            <span>KNOWN-AT-TIME</span>
                          </div>
                          <div className="text-sm opacity-95">
                            Dynamic features known in advance from calendars or schedules.
                          </div>
                          <div className="text-xs mt-2 opacity-80 italic">
                            Example: holidays, planned promotions, weekday
                          </div>
                        </div>
                        
                        <div className="bg-white bg-opacity-20 rounded-lg p-4" style={{ borderLeft: `4px solid ${colors.accent}` }}>
                          <div className="font-bold text-lg mb-2 flex items-center gap-2">
                            <span>‚ö†Ô∏è</span>
                            <span>DYNAMIC (Unknown)</span>
                          </div>
                          <div className="text-sm opacity-95">
                            Features that change over time and are NOT known at forecast time.
                          </div>
                          <div className="text-xs mt-2 opacity-80 italic">
                            Example: future prices, competitor actions
                          </div>
                        </div>
                        
                        <div className="bg-white bg-opacity-20 rounded-lg p-4" style={{ borderLeft: `4px solid ${colors.dark}` }}>
                          <div className="font-bold text-lg mb-2 flex items-center gap-2">
                            <span>üéØ</span>
                            <span>TARGET</span>
                          </div>
                          <div className="text-sm opacity-95">
                            What you're predicting. Can use PAST values as lags, never future.
                          </div>
                          <div className="text-xs mt-2 opacity-80 italic">
                            Example: sales (d_1...d_1941)
                          </div>
                        </div>
                        
                        <div className="bg-white bg-opacity-20 rounded-lg p-4 md:col-span-2 lg:col-span-2" style={{ borderLeft: '4px solid #c41e3a' }}>
                          <div className="font-bold text-lg mb-2 flex items-center gap-2">
                            <span>üö®</span>
                            <span>DATA LEAKAGE</span>
                          </div>
                          <div className="text-sm opacity-95">
                            Using future information to predict the future. Happens when you misclassify features above.
                          </div>
                          <div className="text-xs mt-2 opacity-80 italic">
                            Example: Using next week's actual price to forecast next week's sales
                          </div>
                        </div>
                      </div>
                      
                      <div className="bg-white bg-opacity-15 rounded-lg p-4 border-l-4 border-white">
                        <div className="font-bold mb-2">‚ö° The Critical Question</div>
                        <div className="text-sm">
                          Before using any feature, ask: <strong>"Will I actually have this data when I need to make the forecast?"</strong>
                          <br/>
                          Correctly classifying features prevents leakage and ensures production success.
                        </div>
                      </div>
                    </div>

                    <div className="bg-white rounded-xl p-8 shadow-lg mb-6">
                      <h2 className="text-2xl font-bold text-gray-800 mb-4">Core Terminology</h2>
                      <p className="text-gray-700 mb-4">
                        These four concepts form the foundation of production-ready forecasting. 
                        Below, you'll find EVERY column in the M5 dataset classified by type. 
                        Understanding which category each field belongs to prevents the most common‚Äîand most expensive‚Äîmistakes.
                      </p>
                      <div className="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded">
                        <div className="font-bold text-indigo-900 mb-2">üìã Complete M5 Classification</div>
                        <div className="text-sm text-indigo-800">
                          This is an exhaustive list. Every single column from sales_train.csv, calendar.csv, 
                          and sell_prices.csv is classified below. Use this as a reference when building your features.
                        </div>
                      </div>
                    </div>

                    {/* The Leakage Trap */}
                    <div className="bg-gradient-to-r from-red-50 to-orange-50 rounded-xl p-8 border-4 border-red-400 shadow-lg mb-6">
                      <div className="flex items-center gap-3 mb-4">
                        <AlertTriangle className="w-8 h-8 text-red-600" />
                        <h3 className="text-2xl font-bold text-red-800">The Leakage Trap</h3>
                      </div>
                      <p className="text-gray-700 mb-4">
                        The M5 dataset is deceptively simple. The biggest mistake beginners make? 
                        <strong className="text-red-700"> Using future prices to predict future sales.</strong>
                      </p>
                      <div className="bg-white rounded-lg p-4 mb-4">
                        <div className="font-mono text-sm text-gray-800 mb-2">
                          ‚ùå <strong>WRONG:</strong> "Let's join next week's actual price to forecast next week's sales"
                        </div>
                        <div className="font-mono text-sm text-gray-800">
                          ‚úÖ <strong>RIGHT:</strong> "Let's use last week's price or the planned promotion schedule"
                        </div>
                      </div>
                      <p className="text-sm text-gray-700">
                        The concepts below will teach you to spot these issues before they contaminate your pipeline. 
                        Understanding STATIC vs. DYNAMIC vs. KNOWN-AT-TIME is the key to preventing leakage.
                      </p>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                      {conceptCards.map(concept => (
                        <ConceptCard key={concept.id} concept={concept} />
                      ))}
                    </div>

                    {/* Real-World Scenarios - Truncated for brevity, but included in full file */}
                  </div>
                )}

                {/* Cheat Sheet Section */}
                {expandedSection === 'cheatsheet' && (
                  <div className="space-y-6">
                    <div className="bg-white rounded-xl p-8 shadow-lg">
                      <h2 className="text-2xl font-bold text-gray-800 mb-4">üìã Complete M5 Column Reference</h2>
                      <p className="text-gray-700 mb-6">
                        Use this as your quick reference when building features. Every single column in the M5 dataset 
                        is classified here by type. Bookmark this page and refer back when you're unsure about a field's availability.
                      </p>
                      
                      <div className="space-y-6">
                        {/* Static Columns */}
                        <div className="p-5 rounded-lg" style={{ borderLeft: '4px solid #53b4e6', backgroundColor: 'rgba(83, 180, 230, 0.1)' }}>
                          <div className="flex items-center gap-2 mb-3">
                            <CheckCircle className="w-5 h-5" style={{ color: '#2596be' }} />
                            <h4 className="text-lg font-bold" style={{ color: '#1d1f56' }}>STATIC Columns (5 total)</h4>
                          </div>
                          <div className="text-sm mb-3" style={{ color: '#2596be' }}>
                            ‚úì Never change over time ‚Ä¢ ‚úì Safe to join anytime ‚Ä¢ ‚úì No leakage risk
                          </div>
                          <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                            {['item_id', 'dept_id', 'cat_id', 'store_id', 'state_id'].map(col => (
                              <code key={col} className="bg-white px-3 py-2 rounded text-xs font-bold text-center" style={{ border: '2px solid #53b4e6', color: '#1d1f56' }}>
                                {col}
                              </code>
                            ))}
                          </div>
                          <div className="text-xs mt-3 italic" style={{ color: '#2596be' }}>
                            Found in: sales_train.csv (all 5), sell_prices.csv (item_id, store_id)
                          </div>
                        </div>

                        {/* Known-At-Time Columns */}
                        <div className="p-5 rounded-lg" style={{ borderLeft: '4px solid #3a2f7e', backgroundColor: 'rgba(58, 47, 126, 0.1)' }}>
                          <div className="flex items-center gap-2 mb-3">
                            <Calendar className="w-5 h-5" style={{ color: '#3a2f7e' }} />
                            <h4 className="text-lg font-bold" style={{ color: '#1d1f56' }}>KNOWN-AT-TIME Columns (11 total)</h4>
                          </div>
                          <div className="text-sm mb-3" style={{ color: '#3a2f7e' }}>
                            ‚úì Known in advance ‚Ä¢ ‚úì Safe for forecasting ‚Ä¢ ‚úì Calendar-based
                          </div>
                          <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                            {['date', 'wday', 'weekday', 'month', 'year', 'event_name_1', 'event_type_1', 'event_name_2', 'event_type_2', 'snap_CA', 'snap_TX', 'snap_WI'].map(col => (
                              <code key={col} className="bg-white px-3 py-2 rounded text-xs font-bold text-center" style={{ border: '2px solid #3a2f7e', color: '#1d1f56' }}>
                                {col}
                              </code>
                            ))}
                          </div>
                          <div className="text-xs mt-3 italic" style={{ color: '#3a2f7e' }}>
                            Found in: calendar.csv (all fields except wm_yr_wk which is used for joining)
                          </div>
                        </div>

                        {/* Dynamic (Unknown) Columns */}
                        <div className="p-5 rounded-lg" style={{ borderLeft: '4px solid #2d42a7', backgroundColor: 'rgba(45, 66, 167, 0.1)' }}>
                          <div className="flex items-center gap-2 mb-3">
                            <AlertTriangle className="w-5 h-5" style={{ color: '#2d42a7' }} />
                            <h4 className="text-lg font-bold" style={{ color: '#1d1f56' }}>DYNAMIC (Unknown) Columns (2 total)</h4>
                          </div>
                          <div className="text-sm mb-3" style={{ color: '#2d42a7' }}>
                            ‚ö†Ô∏è Changes over time ‚Ä¢ ‚ö†Ô∏è NOT known at forecast time ‚Ä¢ ‚ö†Ô∏è HIGH leakage risk
                          </div>
                          <div className="grid grid-cols-2 gap-2">
                            {['sell_price', 'wm_yr_wk'].map(col => (
                              <code key={col} className="bg-white px-3 py-2 rounded text-xs font-bold text-center" style={{ border: '2px solid #2d42a7', color: '#1d1f56' }}>
                                {col}
                              </code>
                            ))}
                          </div>
                          <div className="text-xs mt-3 italic" style={{ color: '#2d42a7' }}>
                            Found in: sell_prices.csv (both), calendar.csv (wm_yr_wk - used as join key)
                          </div>
                          <div className="rounded p-3 mt-3" style={{ backgroundColor: 'rgba(45, 66, 167, 0.15)', border: '1px solid #2d42a7' }}>
                            <div className="text-xs font-bold mb-1" style={{ color: '#1d1f56' }}>üö® CRITICAL WARNING</div>
                            <div className="text-xs" style={{ color: '#2d42a7' }}>
                              <strong>sell_price</strong> is THE most dangerous column in M5. You CANNOT use future prices. 
                              Use lagged prices, planned promotional prices, or price forecasts instead.
                            </div>
                          </div>
                        </div>

                        {/* Target Columns */}
                        <div className="p-5 rounded-lg" style={{ borderLeft: '4px solid #1d1f56', backgroundColor: 'rgba(29, 31, 86, 0.1)' }}>
                          <div className="flex items-center gap-2 mb-3">
                            <AlertTriangle className="w-5 h-5" style={{ color: '#1d1f56' }} />
                            <h4 className="text-lg font-bold" style={{ color: '#1d1f56' }}>TARGET Columns (1,941 total)</h4>
                          </div>
                          <div className="text-sm mb-3" style={{ color: '#3a2f7e' }}>
                            üéØ What you're predicting ‚Ä¢ ‚ö†Ô∏è Can use past as lags ‚Ä¢ ‚ö†Ô∏è NEVER use future values
                          </div>
                          <div className="bg-white px-4 py-3 rounded" style={{ border: '2px solid #1d1f56' }}>
                            <code className="text-sm font-bold" style={{ color: '#1d1f56' }}>
                              d_1, d_2, d_3, ..., d_1939, d_1940, d_1941
                            </code>
                            <div className="text-xs mt-2" style={{ color: '#3a2f7e' }}>
                              Daily unit sales from 2011-01-29 through 2016-06-19 (1,941 days)
                            </div>
                          </div>
                          <div className="text-xs mt-3 italic" style={{ color: '#3a2f7e' }}>
                            Found in: sales_train.csv (1,941 columns, one per day)
                          </div>
                          <div className="rounded p-3 mt-3" style={{ backgroundColor: 'rgba(196, 30, 58, 0.1)', border: '1px solid #c41e3a' }}>
                            <div className="text-xs font-bold mb-1" style={{ color: '#c41e3a' }}>üö® LEAKAGE EXAMPLE</div>
                            <div className="text-xs" style={{ color: '#8b0000' }}>
                              To forecast <strong>d_100</strong>, you can ONLY use <strong>d_1...d_99</strong> as features. 
                              Using d_100 or any future d_X values is data leakage and will cause production failure.
                            </div>
                          </div>
                        </div>
                      </div>

                      <div className="mt-6 rounded-lg p-4" style={{ backgroundColor: 'rgba(37, 150, 190, 0.1)', border: '2px solid #2596be' }}>
                        <div className="text-sm font-bold mb-2" style={{ color: '#1d1f56' }}>üí° Quick Reference Summary</div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-xs" style={{ color: '#2d42a7' }}>
                          <div><strong>Total columns:</strong> 1,959 (5 static + 11 known-at + 2 dynamic + 1,941 target)</div>
                          <div><strong>Safe to use:</strong> Static + Known-At-Time = 16 columns</div>
                          <div><strong>Requires care:</strong> Dynamic (2) - must use lags or plans</div>
                          <div><strong>Target only:</strong> d_1...d_1941 - can create lag features from past values</div>
                        </div>
                      </div>
                    </div>

                    {/* Quick Decision Tree */}
                    <div className="rounded-xl p-8 shadow-lg" style={{ background: 'linear-gradient(135deg, rgba(83, 180, 230, 0.1) 0%, rgba(45, 66, 167, 0.1) 100%)', border: '4px solid #2d42a7' }}>
                      <h3 className="text-2xl font-bold mb-6" style={{ color: '#1d1f56' }}>üéØ Decision Tree: Can I Use This Column?</h3>
                      
                      <div className="space-y-4">
                        <div className="bg-white rounded-lg p-5" style={{ border: '2px solid #53b4e6' }}>
                          <div className="font-bold text-lg mb-2" style={{ color: '#1d1f56' }}>‚úÖ YES - Use it directly</div>
                          <div className="text-sm mb-2" style={{ color: '#8b8b8b' }}>
                            <strong>If the column is:</strong>
                          </div>
                          <ul className="text-sm space-y-1 ml-4" style={{ color: '#2d42a7' }}>
                            <li>‚Ä¢ Any of the 5 STATIC columns (item_id, dept_id, cat_id, store_id, state_id)</li>
                            <li>‚Ä¢ Any of the 11 KNOWN-AT-TIME columns from calendar.csv</li>
                            <li>‚Ä¢ A date-derived feature (weekday, month, year, etc.)</li>
                          </ul>
                          <div className="text-xs mt-2 italic" style={{ color: '#53b4e6' }}>
                            These 16 columns are always safe. No special handling needed.
                          </div>
                        </div>

                        <div className="bg-white rounded-lg p-5" style={{ border: '2px solid #2d42a7' }}>
                          <div className="font-bold text-lg mb-2" style={{ color: '#1d1f56' }}>‚ö†Ô∏è MAYBE - Use with care</div>
                          <div className="text-sm mb-2" style={{ color: '#8b8b8b' }}>
                            <strong>If the column is:</strong>
                          </div>
                          <ul className="text-sm space-y-1 ml-4" style={{ color: '#2d42a7' }}>
                            <li>‚Ä¢ <strong>sell_price</strong> - Use LAGGED values (last week's price) or PLANNED promotional prices</li>
                            <li>‚Ä¢ <strong>wm_yr_wk</strong> - Only use for joining; validate temporal ordering</li>
                            <li>‚Ä¢ <strong>d_X (past values)</strong> - Can create LAG features (d_t-1, d_t-7, etc.) but verify temporal split</li>
                          </ul>
                          <div className="text-xs mt-2 italic" style={{ color: '#2d42a7' }}>
                            These require explicit temporal handling. Document your assumptions.
                          </div>
                        </div>

                        <div className="bg-white rounded-lg p-5" style={{ border: '2px solid #c41e3a' }}>
                          <div className="font-bold text-lg mb-2" style={{ color: '#1d1f56' }}>‚ùå NO - Do not use</div>
                          <div className="text-sm mb-2" style={{ color: '#8b8b8b' }}>
                            <strong>If the column is:</strong>
                          </div>
                          <ul className="text-sm space-y-1 ml-4" style={{ color: '#c41e3a' }}>
                            <li>‚Ä¢ <strong>sell_price</strong> for FUTURE weeks - You don't know next week's actual price</li>
                            <li>‚Ä¢ <strong>d_X</strong> where X ‚â• forecast date - You can't use the future to predict the future</li>
                            <li>‚Ä¢ Any value that would require "peeking" into the future</li>
                          </ul>
                          <div className="text-xs mt-2 italic" style={{ color: '#c41e3a' }}>
                            This is data leakage. Models will look great in validation but fail in production.
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Common Leakage Patterns */}
                    <div className="bg-white rounded-xl p-8 shadow-lg">
                      <h3 className="text-2xl font-bold mb-6" style={{ color: '#1d1f56' }}>üö® Common Leakage Patterns to Avoid</h3>
                      
                      <div className="space-y-4">
                        <div className="flex gap-4 items-start p-4 rounded" style={{ backgroundColor: 'rgba(196, 30, 58, 0.1)', borderLeft: '4px solid #c41e3a' }}>
                          <div className="text-2xl">‚ùå</div>
                          <div>
                            <div className="font-bold mb-1" style={{ color: '#c41e3a' }}>Joining prices without time constraint</div>
                            <code className="text-xs px-2 py-1 rounded block mb-2" style={{ backgroundColor: 'rgba(196, 30, 58, 0.15)', color: '#8b0000' }}>
                              df.merge(prices, on=['item_id', 'store_id', 'wm_yr_wk'])  # WRONG
                            </code>
                            <div className="text-sm" style={{ color: '#8b0000' }}>
                              This joins ALL prices, including future prices. Always filter prices to ‚â§ forecast_date.
                            </div>
                          </div>
                        </div>

                        <div className="flex gap-4 items-start p-4 rounded" style={{ backgroundColor: 'rgba(196, 30, 58, 0.1)', borderLeft: '4px solid #c41e3a' }}>
                          <div className="text-2xl">‚ùå</div>
                          <div>
                            <div className="font-bold mb-1" style={{ color: '#c41e3a' }}>Using current period sales as feature</div>
                            <code className="text-xs px-2 py-1 rounded block mb-2" style={{ backgroundColor: 'rgba(196, 30, 58, 0.15)', color: '#8b0000' }}>
                              {"train_df['y'] = train_df['d_100']  # Predicting d_100"}<br/>
                              {"train_df['feature'] = train_df['d_100']  # WRONG - using same day"}
                            </code>
                            <div className="text-sm" style={{ color: '#8b0000' }}>
                              You can't know d_100's sales when forecasting d_100. Only use d_1...d_99.
                            </div>
                          </div>
                        </div>

                        <div className="flex gap-4 items-start p-4 rounded" style={{ backgroundColor: 'rgba(196, 30, 58, 0.1)', borderLeft: '4px solid #c41e3a' }}>
                          <div className="text-2xl">‚ùå</div>
                          <div>
                            <div className="font-bold mb-1" style={{ color: '#c41e3a' }}>Rolling window that includes future</div>
                            <code className="text-xs px-2 py-1 rounded block mb-2" style={{ backgroundColor: 'rgba(196, 30, 58, 0.15)', color: '#8b0000' }}>
                              {"df['rolling_mean_7'] = df['y'].rolling(7, center=True).mean()  # WRONG"}
                            </code>
                            <div className="text-sm" style={{ color: '#8b0000' }}>
                              center=True uses future values. Use center=False or min_periods to look backward only.
                            </div>
                          </div>
                        </div>

                        <div className="flex gap-4 items-start p-4 rounded" style={{ backgroundColor: 'rgba(83, 180, 230, 0.1)', borderLeft: '4px solid #53b4e6' }}>
                          <div className="text-2xl">‚úÖ</div>
                          <div>
                            <div className="font-bold mb-1" style={{ color: '#2596be' }}>Correct lag feature creation</div>
                            <code className="text-xs px-2 py-1 rounded block mb-2" style={{ backgroundColor: 'rgba(83, 180, 230, 0.15)', color: '#1d1f56' }}>
                              {"df['lag_1'] = df.groupby('unique_id')['y'].shift(1)  # Previous day"}<br/>
                              {"df['lag_7'] = df.groupby('unique_id')['y'].shift(7)  # Same day last week"}
                            </code>
                            <div className="text-sm" style={{ color: '#2596be' }}>
                              shift() creates proper lags. For d_100, lag_1 gives you d_99, which is safe.
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<M5DatasetExplorer />);
    </script>
</body>
</html>
